(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{34881:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return accounts}});var n=a(1029),r=a(90781),l=a(86028),c=a(75271),s=a(28533),o=a(79498);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var AddAccountModal=({addAccount:e})=>{let[t,a]=(0,c.useState)(!1),{register:n,handleSubmit:u,reset:m,formState:{errors:i}}=(0,s.cI)(),d=(0,c.useCallback)(()=>a(!1),[a]),p=(0,c.useCallback)(t=>{e(t),m(),d()},[e,d,m]),y=(0,c.useId)(),{values:{currencyRates:E,preferredDisplayCurrency:f}}=(0,c.useContext)(l.Z);return c.createElement(c.Fragment,null,c.createElement("button",{onClick:()=>a(e=>!e),className:"btn btn-primary space-x-2"},c.createElement(o.RWZ,{className:"inline"}),c.createElement("span",{className:"align-middle"},"Add account")),c.createElement(r.u_,{isOpen:t,onDismiss:d},c.createElement("form",{onSubmit:u(p),className:"rounded bg-indigo-500 p-4 dark:bg-indigo-900"},c.createElement("div",{className:"pb-4"},c.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-200"},"Add new account"),c.createElement("fieldset",{className:"space-y-2"},c.createElement(r.II,_extends({placeholder:"Savings, Investments...",label:"Name"},n("name",{required:!0}),{errorMessage:i.name&&"Please provide a name for your account"})),c.createElement("label",{className:"flex flex-col space-y-2"},c.createElement("span",{className:"modal-form-label"},"Account type"),c.createElement("select",_extends({className:"modal-select"},n("type",{required:!0})),c.createElement("option",{value:"Cash"},"Cash"),c.createElement("option",{value:"Investment"},"Investment"))),c.createElement("label",{htmlFor:y,className:"flex flex-col space-y-2"},c.createElement("span",{className:"modal-form-label"},"Account currency"),c.createElement("select",_extends({id:y,defaultValue:f,className:"modal-select"},n("currency",{required:!0})),Object.keys(E.usd).map(e=>e.toUpperCase()).map(e=>c.createElement("option",{key:e,value:e},e)))))),c.createElement(r.qO,null,c.createElement(r.zx,{buttonType:"Transparent",onClick:d},"Cancel"),c.createElement(r.zx,{type:"submit"},"Add")))))},u=a(16885),m=a(67850),i=a(89115);let d=(0,c.createContext)({state:{accounts:[],entries:{}},dispatch:e=>{}});function getDefaultAccountState(){return{accounts:[],entries:{}}}function accountReducer(e,t){return(0,i.n)("account_state",reducer)(e,t)}function reducer(e,t){switch(t.type){case"RESET":return getDefaultAccountState();case"LOAD STATE":return{...t.state,accounts:t.state.accounts.sort((e,t)=>e.sortKey-t.sortKey)};case"ADD ACCOUNT":return{...e,accounts:e.accounts.concat(t.account)};case"ADD ENTRY":return e.entries[t.date]={},{...e};case"EDIT ENTRY FOR ACCOUNT":return e.entries[t.key][t.name]=t.value,e.entries=(0,m.CV)(e.entries),{...e};case"DELETE ENTRY":return delete e.entries[t.date],{...e,entries:e.entries};case"SORT ACCOUNTS":return{...e,accounts:e.accounts.map(e=>({...e,sortKey:t.order.find(t=>t.id===e.id)?.sortKey??0})).sort((e,t)=>e.sortKey-t.sortKey)};default:return console.warn(`action type not handled: ${JSON.stringify(t)}`),e}}function AddEntryModal_extends(){return(AddEntryModal_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let p=(0,c.memo)(()=>{let{dispatch:e}=(0,c.useContext)(d),[t,a]=(0,c.useState)(!1),n=(0,c.useCallback)(()=>a(!1),[a]),{register:l,handleSubmit:o}=(0,s.cI)(),u=o(({date:t})=>{e({type:"ADD ENTRY",date:t}),n()});return c.createElement(c.Fragment,null,c.createElement(r.zx,{buttonType:"Primary",onClick:()=>a(!0)},"Add entry"),c.createElement(r.u_,{isOpen:t,onDismiss:n},c.createElement("form",{onSubmit:u},c.createElement("div",{className:"p-4"},c.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-400"},"Add new entry on date"),c.createElement(r.II,AddEntryModal_extends({type:"date",className:"m-4"},l("date")))),c.createElement(r.qO,null,c.createElement(r.zx,{buttonType:"Primary",type:"submit"},"Add")))))});p.displayName="AddEntryModal";var y=a(48050),E=a(97108),f=a(17961),g=a(64720),x=a(92853),v=a(80791),b=a(60166),C=a(56170),N=a(16365);function OverviewChart_extends(){return(OverviewChart_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let h={xAccessor:e=>e.x,yAccessor:e=>e.y};var AccountOverview_OverviewChart=()=>{let e=(0,N.Z)(),{state:t}=(0,c.useContext)(d),{values:a}=(0,c.useContext)(l.Z),n=(0,c.useCallback)(e=>Object.keys(t.entries).map(n=>{let r=t.entries[n][e.name],l=void 0===r?void 0:(0,m.fK)(r,a.currencyRates.usd,e.currency,a.preferredDisplayCurrency);return{x:n,y:l}}),[a.currencyRates.usd,a.preferredDisplayCurrency,t.entries]),s=t.accounts.map(e=>({account:e,data:n(e)})),o=(0,c.useCallback)((e,a)=>{let n=s.filter(a).map(e=>e.data);return{name:e,data:Object.keys(t.entries).map((e,t)=>({x:e,y:n.map(e=>e[t].y??0).reduce((e,t)=>e+t,0)}))}},[s,t.entries]),u=["Cash","Investment"].map(e=>o(e,t=>t.account.type===e)).concat([o("Total",()=>!0)]),[i,p]=(0,c.useState)(!0);return c.createElement("div",{className:"py-4"},c.createElement("div",{className:"flex flex-row justify-end bg-transparent"},c.createElement("label",{className:"space-x-4 px-4"},c.createElement("span",{className:"h-full align-middle"},"Show totals"),c.createElement(r.ZD,{checked:i,onChange:e=>p(e.target.checked)}))),c.createElement(E.Z,{height:500,margin:{top:50,bottom:30,right:20,left:70},xScale:{type:"band"},yScale:{type:"linear"},theme:e?f.Z:g.Z},c.createElement(x.Z,{orientation:"bottom",hideAxisLine:!0}),c.createElement(x.Z,{orientation:"left"}),c.createElement(v.Z,{columns:!1,numTicks:4}),i?u.map(e=>c.createElement(b.Z,OverviewChart_extends({key:e.name,dataKey:e.name,data:e.data},h))):s.map(e=>c.createElement(b.Z,OverviewChart_extends({key:e.account.id,dataKey:e.account.name,data:e.data},h))),c.createElement(C.Z,{snapTooltipToDatumX:!0,snapTooltipToDatumY:!0,showVerticalCrosshair:!0,showSeriesGlyphs:!0,renderTooltip:({tooltipData:e,colorScale:t})=>{if(e?.nearestDatum&&t)return c.createElement("div",{className:"flex flex-col"},c.createElement("div",{style:{color:t(e.nearestDatum.key)}},e.nearestDatum.key),c.createElement("span",null,h.xAccessor(e.nearestDatum.datum)),c.createElement("span",{className:"text-green-700 dark:text-green-500"},(0,m.xG)(h.yAccessor(e.nearestDatum.datum),a.preferredDisplayCurrency)))}})))},k=a(85899),O=a.n(k),A=a(50528),w=a(4690),D=a(52857),S=a(73200),SortableDragAndDropList_SortableDragAndDropItem=({id:e,type:t,index:a,move:n,children:r,className:l})=>{let s=(0,c.useRef)(null),[{handlerId:o},u]=(0,D.L)({accept:t,collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){if(!s.current)return;let r=e.index;if(r===a)return;let l=s.current?.getBoundingClientRect(),c=(l.bottom-l.top)/2,o=t.getClientOffset(),u=o.y-l.top;r<a&&u<c||r>a&&u>c||(n(r,a),e.index=a)}},[a]),[{isDragging:m},i]=(0,S.c)(()=>({type:t,item:()=>({id:e,index:a}),collect:e=>({isDragging:!!e.isDragging()})}),[a]);return i(u(s)),c.createElement("li",{ref:s,"data-handler-id":o,className:`cursor-move ${m?"opacity-25":""} ${l||""}`},r)},components_SortableDragAndDropList=function({typeIdentifier:e,items:t,setItems:a,children:n,className:r}){let l=(0,c.useCallback)((e,t)=>{a(a=>O()(a,{$splice:[[e,1],[t,0,a[e]]]}))},[a]);return c.createElement(A.W,{backend:w.PD},c.createElement("ol",null,t.map((t,a)=>c.createElement(SortableDragAndDropList_SortableDragAndDropItem,{key:t.id,id:t.id,index:a,move:l,type:e,className:r},n(t)))))},components_Spinner=()=>c.createElement("svg",{className:"h-5 w-5 animate-spin text-black dark:text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},c.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),c.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}));let AccountCard=({account:e})=>c.createElement("div",null,e.name);var AccountOverview_OrderAccountsModal=()=>{let{state:{accounts:e},dispatch:t}=(0,c.useContext)(d),[a,n]=(0,c.useState)(!1),[l,s]=(0,c.useState)("NONE"),[u,m]=(0,c.useState)((0,c.useMemo)(()=>e,[e])),i=(0,c.useCallback)(e=>c.createElement(AccountCard,{account:e}),[]),p=(0,y.ku)(`${y.ft}/account`,{method:"PUT"}),E=(0,c.useCallback)(async()=>{try{s("SAVING");let e=u.map((e,t)=>({id:e.id,sortKey:t,name:e.name}));await p(e),t({type:"SORT ACCOUNTS",order:e}),s("SAVED"),setTimeout(()=>s("NONE"),1e3)}catch{console.warn("Unable to save order of accounts"),s("NONE")}},[t,u,p]);return c.createElement(c.Fragment,null,c.createElement(r.zx,{onClick:()=>n(!0),className:"btn btn-primary flex items-center gap-x-2"},c.createElement(o.j7b,{className:"inline"}),c.createElement("span",{className:"align-middle"},"Order accounts")),c.createElement(r.u_,{isOpen:a,onDismiss:()=>n(!1)},c.createElement("div",{className:"max-h-screen w-80 max-w-full overflow-y-scroll rounded bg-slate-200 p-4 dark:bg-slate-700"},c.createElement("h2",{className:"modal-header"},"Reorder accounts"),c.createElement(components_SortableDragAndDropList,{className:"m-4 rounded bg-green-500 p-2",typeIdentifier:"ACCOUNT",items:u,setItems:m},i),c.createElement(r.qO,null,c.createElement(r.zx,{buttonType:"Secondary",onClick:()=>n(!1)},"Close"),c.createElement(r.zx,{onClick:E},"Save order"))),"NONE"!==l&&c.createElement("div",{className:"absolute top-0 left-0 z-10 flex h-full w-full flex-row items-center justify-center bg-black opacity-75"},"SAVING"===l&&c.createElement(components_Spinner,null),"SAVED"===l&&c.createElement("div",{className:"text-xl font-bold"},"Order saved!"))))},T=a(57289),_=a(31485),AccountOverview_Cell=({account:e,entry:t,date:a})=>{let{dispatch:n}=(0,c.useContext)(d),r=(0,c.useRef)(null),l=(0,y.ku)(`${y.ft}/account/entry`,{method:"POST"}),s=(0,c.useCallback)(async t=>{let r=(0,m.p3)(t.currentTarget.innerText);r&&(await l({date:a,amount:r,accountId:e.id}),n({type:"EDIT ENTRY FOR ACCOUNT",name:e.name,key:a,value:r}))},[e.id,e.name,a,n,l]),o=(0,m.xG)(t[e.name],e.currency);return c.createElement(c.Fragment,null,c.createElement("td",{key:e.name,contentEditable:!0,suppressContentEditableWarning:!0,ref:r,onBlur:s,className:"table-cell"},o))},AccountOverview_Table=()=>{let{state:{accounts:e}}=(0,c.useContext)(d);return c.createElement("div",{className:"account-table"},c.createElement("table",{className:"w-full"},c.createElement("thead",null,c.createElement(TableHeader,{accounts:e})),c.createElement("tbody",null,c.createElement(TableBody,null)),c.createElement("tfoot",null,c.createElement(TableHeader,{accounts:e}))))};let TableHeader=({accounts:e})=>c.createElement(c.Fragment,null,c.createElement("tr",{className:"whitespace-nowrap text-right"},c.createElement("th",{className:"pr-6 text-center"},"Date"),c.createElement("th",{className:"px-4 text-green-700 dark:text-green-500"},"Gain"),c.createElement("th",{className:"px-4 text-blue-700 dark:text-blue-500"},"Total"),c.createElement("th",{className:"px-4 text-yellow-700 dark:text-yellow-500"},"Total cash"),c.createElement("th",{className:"px-4 text-purple-700 dark:text-purple-500"},"Total investments"),e.map(e=>c.createElement("th",{key:e.name,className:"px-4"},c.createElement("span",null,e.name))),c.createElement("th",null))),TableBody=()=>{let{state:{accounts:e,entries:t}}=(0,c.useContext)(d),a=Object.keys(t).map(a=>useSummarizedAccounts(e,t,a));return c.createElement(c.Fragment,null,Object.keys(t).map((n,r)=>c.createElement("tr",{key:n,style:{height:26},className:"whitespace-nowrap text-right font-mono odd:bg-gray-300 dark:odd:bg-gray-800"},c.createElement("td",{className:"pr-6 text-center"},n),c.createElement(RowSummary,{date:n,index:r,totals:a}),e.map(e=>c.createElement(AccountOverview_Cell,{key:e.name,account:e,entry:t[n],date:n})),c.createElement(RowActions,{date:n}))))},RowSummary=({index:e,date:t,totals:a})=>{let{state:{accounts:n,entries:r}}=(0,c.useContext)(d),{values:{preferredDisplayCurrency:s}}=(0,c.useContext)(l.Z),o=0===e?0:a[e]-a[e-1],u=a[e],i=useSummarizedAccounts(n,r,t,e=>"Cash"===e.type),p=useSummarizedAccounts(n,r,t,e=>"Investment"===e.type);return c.createElement(c.Fragment,null,c.createElement("td",{className:`${(0,T.yY)(o)} cell-summary`},(0,m.xG)(o,s),c.createElement(SummaryInOtherCurrencies,{value:o,index:e})),c.createElement("td",{className:"text-blue-700 dark:text-blue-500 cell-summary"},(0,m.xG)(u,s),c.createElement(SummaryInOtherCurrencies,{value:u,index:e})),c.createElement("td",{className:"text-yellow-700 dark:text-yellow-500 cell-summary"},(0,m.xG)(i,s),c.createElement(SummaryInOtherCurrencies,{value:i,index:e})),c.createElement("td",{className:"text-purple-700 dark:text-purple-500 cell-summary"},(0,m.xG)(p,s),c.createElement(SummaryInOtherCurrencies,{value:p,index:e})))},SummaryInOtherCurrencies=({value:e,index:t})=>{let{values:{preferredDisplayCurrency:a,preferredCurrencies:n,currencyRates:r}}=(0,c.useContext)(l.Z);return c.createElement("ol",{style:{top:-t*n.length}},n.map(t=>c.createElement("li",{key:t},(0,m.xG)((0,m.fK)(e,r.usd,a,t),t))))},RowActions=({date:e})=>{let{dispatch:t}=(0,c.useContext)(d);return c.createElement("td",{className:"pl-4"},c.createElement(_.Z,{onClick:()=>t({type:"DELETE ENTRY",date:e})}))};function useSummarizedAccounts(e,t,a,n=()=>!0){let{values:{currencyRates:r,preferredDisplayCurrency:s}}=(0,c.useContext)(l.Z);return e.filter(n).map(e=>(0,m.fK)(t[a][e.name]??0,r.usd,e.currency,s)).reduce((e,t)=>e+t,0)}var I=a(84687);let R=(0,c.memo)(()=>{let[e,t]=(0,c.useReducer)(accountReducer,(0,i.v)("account_state",getDefaultAccountState())),a=(0,y.h_)(`${y.ft}/account`,{method:"GET"});(0,c.useEffect)(()=>{if(!a.loading&&a.data){let e=a.data;t({type:"LOAD STATE",state:{accounts:e,entries:function(e){let t={};for(let a of e)for(let e of a.entries){let n=(0,u.p)(e.date);n in t||(t[n]={}),t[n][a.name]=e.amount}return Object.keys(t).sort().reduce((e,a)=>(e[a]=t[a],e),{})}(e)}})}},[a.loading]);let n=(0,y.ku)(`${y.ft}/account`,{method:"POST"}),r=(0,c.useCallback)(async e=>{await n(e),t({type:"ADD ACCOUNT",account:e})},[n]);return a.loading?c.createElement("div",null,"Loading data"):c.createElement(d.Provider,{value:{state:e,dispatch:t}},c.createElement(AccountOverview_Table,null),c.createElement("div",{className:"flex flex-row justify-between px-4"},c.createElement(AddAccountModal,{addAccount:r}),c.createElement(AccountOverview_OrderAccountsModal,null),c.createElement(p,null)),c.createElement(AccountOverview_OverviewChart,null))});R.displayName="AccountOverview";var j=(0,I.u3)(R,{onRedirecting:()=>c.createElement("div",null,"Redirecting you to the login page")}),accounts=()=>c.createElement(c.Fragment,null,c.createElement(n.Z,{title:"Accounts"}),c.createElement(j,null))},31485:function(e,t,a){"use strict";a.d(t,{Z:function(){return DeleteButton}});var n=a(75271),r=a(79498);function DeleteButton({onClick:e}){return n.createElement("button",{onClick:e,className:"flex focus:outline-none"},n.createElement(r.BFV,{size:24,className:"text-red-700 dark:text-red-500"}))}},1029:function(e,t,a){"use strict";var n=a(79238),r=a.n(n),l=a(75271);t.Z=({title:e})=>{let t=`${e} | Finance`;return l.createElement(r(),null,l.createElement("title",null,t))}},57289:function(e,t,a){"use strict";function getValueColorIndicator(e){return e>0?n.positiveColor:e<0?n.negativeColor:""}function getBackgroundColorValueIndicator(e){return e>0?n.positiveBackground:e<0?n.positiveBackground:""}a.d(t,{yY:function(){return getValueColorIndicator},yZ:function(){return getBackgroundColorValueIndicator}});let n={positiveColor:"text-green-700 dark:text-green-500",negativeColor:"text-red-700 dark:text-red-500",positiveBackground:"bg-green-400 dark:bg-green-700"}},67850:function(e,t,a){"use strict";a.d(t,{CV:function(){return sortObject},fK:function(){return convertToCurrency},p3:function(){return parseNumber},sL:function(){return useConverter},xG:function(){return formatCurrency}});var n=a(75271);function parseNumber(e){return Number.parseFloat(e.toString().replace(/[^.\d]/g,""))}function formatCurrency(e,t,a){if(!e||Number.isNaN(e))return"0";let format=t=>e.toLocaleString("en-US",{style:"currency",currency:t,currencyDisplay:"symbol",...a});try{return format(t??"USD")}catch(a){if(a instanceof RangeError&&a.message.startsWith("Invalid currency code")&&t)return format("USD").replace("USD",t);return e.toString()}}function convertToCurrency(e,t,a,n){return e*getConversionRate(t,a,n)}function getConversionRate(e,t,a){let n=t?.toLowerCase(),r=a?.toLowerCase();return n&&r&&n!==r?"usd"===n?"GBp"===a?100*e.gbp:r in e?e[r]:1:"usd"!==r?getConversionRate(e,t,"usd")*getConversionRate(e,"usd",a):"GBp"===t?1/(100*e.gbp):n in e?1/e[n]:1:1}function useConverter(e,t,a){return(0,n.useCallback)(n=>n*getConversionRate(a,e,t),[e,a,t])}function sortObject(e){return Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{})}Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"})},16885:function(e,t,a){"use strict";function formatDate(e){let t=e.getFullYear(),a=""+(e.getMonth()+1),n=""+e.getDate();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[t,a,n].join("-")}a.d(t,{p:function(){return formatDate}})},65765:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/accounts",function(){return a(34881)}])}},function(e){e.O(0,[774,533,21,888,179],function(){return e(e.s=65765)}),_N_E=e.O()}]);