(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{5729:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return et}});var n=a(447),r=a(7818),l=a(6508),c=a(7294),s=a(7536),o=a(2370);function u(){return(u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let i=({addAccount:e})=>{let[t,a]=(0,c.useState)(!1),{register:n,handleSubmit:i,reset:m,formState:{errors:d}}=(0,s.cI)(),p=(0,c.useCallback)(()=>a(!1),[a]),y=(0,c.useCallback)(t=>{e(t),m(),p()},[e,p,m]),f=(0,c.useId)(),{values:{currencyRates:E,preferredDisplayCurrency:x}}=(0,c.useContext)(l.Z);return c.createElement(c.Fragment,null,c.createElement("button",{onClick:()=>a(e=>!e),className:"btn btn-primary space-x-2"},c.createElement(o.RWZ,{className:"inline"}),c.createElement("span",{className:"align-middle"},"Add account")),c.createElement(r.u_,{isOpen:t,onDismiss:p},c.createElement("form",{onSubmit:i(y),className:"rounded bg-indigo-500 p-4 dark:bg-indigo-900"},c.createElement("div",{className:"pb-4"},c.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-200"},"Add new account"),c.createElement("fieldset",{className:"space-y-2"},c.createElement(r.II,u({placeholder:"Savings, Investments...",label:"Name"},n("name",{required:!0}),{errorMessage:d.name&&"Please provide a name for your account"})),c.createElement("label",{className:"flex flex-col space-y-2"},c.createElement("span",{className:"modal-form-label"},"Account type"),c.createElement("select",u({className:"modal-select"},n("type",{required:!0})),c.createElement("option",{value:"Cash"},"Cash"),c.createElement("option",{value:"Investment"},"Investment"))),c.createElement("label",{htmlFor:f,className:"flex flex-col space-y-2"},c.createElement("span",{className:"modal-form-label"},"Account currency"),c.createElement("select",u({id:f,defaultValue:x,className:"modal-select"},n("currency",{required:!0})),Object.keys(E.usd).map(e=>e.toUpperCase()).map(e=>c.createElement("option",{key:e,value:e},e)))))),c.createElement(r.qO,null,c.createElement(r.zx,{buttonType:"Transparent",onClick:p},"Cancel"),c.createElement(r.zx,{type:"submit"},"Add")))))};var m=a(6645),d=a(515),p=a(7384);let y=(0,c.createContext)({state:{accounts:[],entries:{}},dispatch(e){}});function f(){return{accounts:[],entries:{}}}function E(e,t){return(0,p.n)("account_state",x)(e,t)}function x(e,t){switch(t.type){case"RESET":return f();case"LOAD STATE":return{...t.state,accounts:t.state.accounts.sort((e,t)=>e.sortKey-t.sortKey)};case"ADD ACCOUNT":return{...e,accounts:e.accounts.concat(t.account)};case"ADD ENTRY":return e.entries[t.date]={},{...e};case"EDIT ENTRY FOR ACCOUNT":return e.entries[t.key][t.name]=t.value,e.entries=(0,d.CV)(e.entries),{...e};case"DELETE ENTRY":return delete e.entries[t.date],{...e,entries:e.entries};case"SORT ACCOUNTS":return{...e,accounts:e.accounts.map(e=>({...e,sortKey:t.order.find(t=>t.id===e.id)?.sortKey??0})).sort((e,t)=>e.sortKey-t.sortKey)};default:return console.warn(`action type not handled: ${JSON.stringify(t)}`),e}}function g(){return(g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let h=(0,c.memo)(()=>{let{dispatch:e}=(0,c.useContext)(y),[t,a]=(0,c.useState)(!1),n=(0,c.useCallback)(()=>a(!1),[a]),{register:l,handleSubmit:o}=(0,s.cI)(),u=o(({date:t})=>{e({type:"ADD ENTRY",date:t}),n()});return c.createElement(c.Fragment,null,c.createElement(r.zx,{buttonType:"Primary",onClick:()=>a(!0)},"Add entry"),c.createElement(r.u_,{isOpen:t,onDismiss:n},c.createElement("form",{onSubmit:u},c.createElement("div",{className:"p-4"},c.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-400"},"Add new entry on date"),c.createElement(r.II,g({type:"date",className:"m-4"},l("date")))),c.createElement(r.qO,null,c.createElement(r.zx,{buttonType:"Primary",type:"submit"},"Add")))))});h.displayName="AddEntryModal";var N=a(7538);function b(e){return e.map(e=>({...e,entries:e.entries.map(e=>({...e,date:new Date(Date.parse(e.date))}))}))}var v=a(876),k=a(8873),C=a(6077),w=a(3667),O=a(4874),T=a(8674),D=a(7398),A=a(9828);function S(){return(S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let j={xAccessor:e=>e.x,yAccessor:e=>e.y},I=()=>{let e=(0,A.Z)(),{state:t}=(0,c.useContext)(y),{values:a}=(0,c.useContext)(l.Z),n=(0,c.useCallback)(e=>Object.keys(t.entries).map(n=>{let r=t.entries[n][e.name],l=void 0===r?void 0:(0,d.fK)(r,a.currencyRates.usd,e.currency,a.preferredDisplayCurrency);return{x:n,y:l}}),[a.currencyRates.usd,a.preferredDisplayCurrency,t.entries]),s=t.accounts.map(e=>({account:e,data:n(e)})),o=(0,c.useCallback)((e,a)=>{let n=s.filter(a).map(e=>e.data);return{name:e,data:Object.keys(t.entries).map((e,t)=>({x:e,y:n.map(e=>e[t].y??0).reduce((e,t)=>e+t,0)}))}},[s,t.entries]),u=["Cash","Investment"].map(e=>o(e,t=>t.account.type===e)).concat([o("Total",()=>!0)]),[i,m]=(0,c.useState)(!0);return c.createElement("div",{className:"py-4"},c.createElement("div",{className:"flex flex-row justify-end bg-transparent"},c.createElement("label",{className:"space-x-4 px-4"},c.createElement("span",{className:"h-full align-middle"},"Show totals"),c.createElement(r.ZD,{checked:i,onChange:e=>m(e.target.checked)}))),c.createElement(v.Z,{height:500,margin:{top:50,bottom:30,right:20,left:70},xScale:{type:"band"},yScale:{type:"linear"},theme:e?k.Z:C.Z},c.createElement(w.Z,{orientation:"bottom",hideAxisLine:!0}),c.createElement(w.Z,{orientation:"left"}),c.createElement(O.Z,{columns:!1,numTicks:4}),i?u.map(e=>c.createElement(T.Z,S({key:e.name,dataKey:e.name,data:e.data},j))):s.map(e=>c.createElement(T.Z,S({key:e.account.id,dataKey:e.account.name,data:e.data},j))),c.createElement(D.Z,{snapTooltipToDatumX:!0,snapTooltipToDatumY:!0,showVerticalCrosshair:!0,showSeriesGlyphs:!0,renderTooltip({tooltipData:e,colorScale:t}){if(e?.nearestDatum&&t)return c.createElement("div",{className:"flex flex-col"},c.createElement("div",{style:{color:t(e.nearestDatum.key)}},e.nearestDatum.key),c.createElement("span",null,j.xAccessor(e.nearestDatum.datum)),c.createElement("span",{className:"text-green-700 dark:text-green-500"},(0,d.xG)(j.yAccessor(e.nearestDatum.datum),a.preferredDisplayCurrency)))}})))};var R=a(7145),Z=a.n(R),G=a(8493),_=a(6963),z=a(9272),K=a(9294);let U=({id:e,type:t,index:a,move:n,children:r,className:l})=>{let s=(0,c.useRef)(null),[{handlerId:o},u]=(0,z.L)({accept:t,collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){if(!s.current)return;let r=e.index;if(r===a)return;let l=s.current?.getBoundingClientRect(),c=(l.bottom-l.top)/2,o=t.getClientOffset(),u=o.y-l.top;r<a&&u<c||r>a&&u>c||(n(r,a),e.index=a)}},[a]),[{isDragging:i},m]=(0,K.c)(()=>({type:t,item:()=>({id:e,index:a}),collect:e=>({isDragging:!!e.isDragging()})}),[a]);return m(u(s)),c.createElement("li",{ref:s,"data-handler-id":o,className:`cursor-move ${i?"opacity-25":""} ${l||""}`},r)};var $=function({typeIdentifier:e,items:t,setItems:a,children:n,className:r}){let l=(0,c.useCallback)((e,t)=>{a(a=>Z()(a,{$splice:[[e,1],[t,0,a[e]]]}))},[a]);return c.createElement(G.W,{backend:_.PD},c.createElement("ol",null,t.map((t,a)=>c.createElement(U,{key:t.id,id:t.id,index:a,move:l,type:e,className:r},n(t)))))};let F=()=>c.createElement("svg",{className:"h-5 w-5 animate-spin text-black dark:text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},c.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),c.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})),P=({account:e})=>c.createElement("div",null,e.name),L=()=>{let{state:{accounts:e},dispatch:t}=(0,c.useContext)(y),[a,n]=(0,c.useState)(!1),[l,s]=(0,c.useState)("NONE"),[u,i]=(0,c.useState)((0,c.useMemo)(()=>e,[e])),m=(0,c.useCallback)(e=>c.createElement(P,{account:e}),[]),d=(0,N.ku)(`${N.ft}/account`,{method:"PUT"}),p=(0,c.useCallback)(async()=>{try{s("SAVING");let e=u.map((e,t)=>({id:e.id,sortKey:t,name:e.name}));await d(e),t({type:"SORT ACCOUNTS",order:e}),s("SAVED"),setTimeout(()=>s("NONE"),1e3)}catch{console.warn("Unable to save order of accounts"),s("NONE")}},[t,u,d]);return c.createElement(c.Fragment,null,c.createElement(r.zx,{onClick:()=>n(!0),className:"btn btn-primary flex items-center gap-x-2"},c.createElement(o.j7b,{className:"inline"}),c.createElement("span",{className:"align-middle"},"Order accounts")),c.createElement(r.u_,{isOpen:a,onDismiss:()=>n(!1)},c.createElement("div",{className:"max-h-screen w-80 max-w-full overflow-y-scroll rounded bg-slate-200 p-4 dark:bg-slate-700"},c.createElement("h2",{className:"modal-header"},"Reorder accounts"),c.createElement($,{className:"m-4 rounded bg-green-500 p-2",typeIdentifier:"ACCOUNT",items:u,setItems:i},m),c.createElement(r.qO,null,c.createElement(r.zx,{buttonType:"Secondary",onClick:()=>n(!1)},"Close"),c.createElement(r.zx,{onClick:p},"Save order"))),"NONE"!==l&&c.createElement("div",{className:"absolute top-0 left-0 z-10 flex h-full w-full flex-row items-center justify-center bg-black opacity-75"},"SAVING"===l&&c.createElement(F,null),"SAVED"===l&&c.createElement("div",{className:"text-xl font-bold"},"Order saved!"))))};var V=a(1635);let B=({account:e,entry:t,date:a})=>{let{dispatch:n}=(0,c.useContext)(y),r=(0,c.useRef)(null),l=(0,N.ku)(`${N.ft}/account/entry`,{method:"POST"}),s=(0,c.useCallback)(async t=>{let r=(0,d.p3)(t.currentTarget.innerText);await l({date:a,amount:r,accountId:e.id}),n({type:"EDIT ENTRY FOR ACCOUNT",name:e.name,key:a,value:r})},[e.id,e.name,a,n,l]),o=(0,d.xG)(t[e.name],e.currency);return c.createElement("td",{key:e.name,contentEditable:!0,ref:r,onBlur:s,className:"px-4 text-right"},o)},Y=()=>{let{state:{accounts:e,entries:t}}=(0,c.useContext)(y),a=Object.keys(t).map(a=>J(e,t,a));return c.createElement("div",{className:"h-full overflow-x-auto pb-4 md:px-4"},c.createElement("table",{className:"w-full"},c.createElement(q,{accounts:e}),c.createElement("tbody",null,Object.keys(t).map((n,r)=>c.createElement("tr",{key:n,className:"whitespace-nowrap text-right font-mono odd:bg-gray-300 dark:odd:bg-gray-800"},c.createElement("td",{className:"pr-6 text-center"},n),c.createElement(M,{date:n,index:r,totals:a}),e.map(e=>c.createElement(B,{key:e.name,account:e,entry:t[n],date:n})),c.createElement(W,{date:n}))))))},q=({accounts:e})=>c.createElement("thead",null,c.createElement("tr",{className:"whitespace-nowrap text-right"},c.createElement("th",{className:"pr-6 text-center"},"Date"),c.createElement("th",{className:"px-4 text-green-700 dark:text-green-500"},"Gain"),c.createElement("th",{className:"px-4 text-blue-700 dark:text-blue-500"},"Total"),c.createElement("th",{className:"px-4 text-yellow-700 dark:text-yellow-500"},"Total cash"),c.createElement("th",{className:"px-4 text-purple-700 dark:text-purple-500"},"Total investments"),e.map(e=>c.createElement("th",{key:e.name,className:"px-4"},c.createElement("span",null,e.name))),c.createElement("th",null))),M=({index:e,date:t,totals:a})=>{let{state:{accounts:n,entries:r}}=(0,c.useContext)(y),{values:{preferredDisplayCurrency:s}}=(0,c.useContext)(l.Z),o=0===e?0:a[e]-a[e-1],u=a[e],i=J(n,r,t,e=>"Cash"===e.type),m=J(n,r,t,e=>"Investment"===e.type);return c.createElement(c.Fragment,null,c.createElement("td",{className:(0,V.y)(o)},(0,d.xG)(o,s)),c.createElement("td",{className:"px-4 text-blue-700 dark:text-blue-500"},(0,d.xG)(u,s)),c.createElement("td",{className:"px-4 text-yellow-700 dark:text-yellow-500"},(0,d.xG)(i,s)),c.createElement("td",{className:"px-4 text-purple-700 dark:text-purple-500"},(0,d.xG)(m,s)))},W=({date:e})=>{let{dispatch:t}=(0,c.useContext)(y);return c.createElement("td",{className:"pl-4"},c.createElement("button",{onClick:()=>t({type:"DELETE ENTRY",date:e}),className:"flex focus:outline-none"},c.createElement(o.BFV,{size:24,className:"text-red-700 dark:text-red-500"})))};function J(e,t,a,n=()=>!0){let{values:{currencyRates:r,preferredDisplayCurrency:s}}=(0,c.useContext)(l.Z);return e.filter(n).map(e=>(0,d.fK)(t[a][e.name]??0,r.usd,e.currency,s)).reduce((e,t)=>e+t,0)}var X=a(8100);let H=(0,c.memo)(()=>{let[e,t]=(0,c.useReducer)(E,(0,p.v)("account_state",f())),a=(0,N.h_)(`${N.ft}/account`,{method:"GET",mode:"cors"},b);(0,c.useEffect)(()=>{if(!a.loading&&a.data){let e=a.data;t({type:"LOAD STATE",state:{accounts:e,entries:function(e){let t={};for(let a of e)for(let n of a.entries){let r=(0,m.p)(n.date);r in t||(t[r]={}),t[r][a.name]=n.amount}return Object.keys(t).sort().reduce((e,a)=>(e[a]=t[a],e),{})}(e)}})}},[a]);let n=(0,N.ku)(`${N.ft}/account`,{method:"POST"}),r=(0,c.useCallback)(async e=>{await n(e),t({type:"ADD ACCOUNT",account:e})},[n]);return a.loading?c.createElement("div",null,"Loading data"):c.createElement(y.Provider,{value:{state:e,dispatch:t}},c.createElement(Y,null),c.createElement("div",{className:"flex flex-row justify-between px-4"},c.createElement(i,{addAccount:r}),c.createElement(L,null),c.createElement(h,null)),c.createElement(I,null))});H.displayName="AccountOverview";var Q=(0,X.u3)(H,{onRedirecting:()=>c.createElement("div",null,"Redirecting you to the login page")});let ee=()=>c.createElement(c.Fragment,null,c.createElement(n.Z,{title:"Accounts"}),c.createElement(Q,null));var et=ee},447:function(e,t,a){"use strict";var n=a(9008),r=a.n(n),l=a(7294);let c=({title:e})=>{let t=`${e} | Finance`;return l.createElement(r(),null,l.createElement("title",null,t))};t.Z=c},7538:function(e,t,a){"use strict";a.d(t,{ft:function(){return o},h_:function(){return u},ku:function(){return i},t1:function(){return m},xh:function(){return c}});var n=a(8100),r=a(7294),l=a(3747);let c=!1,s=l.yG?"https://localhost:5001":"https://finance.oliverflecke.me",o=`${s}/api/v1`;function u(e,t,a){let{getAccessTokenSilently:l}=(0,n.D3)(),[c,s]=(0,r.useState)({loading:!0});return(0,r.useEffect)(()=>{(async()=>{try{console.log("Getting access token");let n=await l();console.log(`Token: ${n}`);let r=await fetch(e,{...t,headers:{Authorization:`Bearer ${n}`}}),o=await r.json();s({...c,data:a?a(o):o,error:void 0,loading:!1})}catch(u){s({...c,error:u,loading:!1})}})()},[]),c}function i(e,t){let{getAccessTokenSilently:a}=(0,n.D3)();return(0,r.useCallback)(async n=>{try{let r=await a();return await fetch(e,{...t,mode:l.yG?"cors":"no-cors",body:n?JSON.stringify(n):void 0,headers:{"Content-Type":"application/json",...t?.headers,Authorization:`Bearer ${r}`}})}catch(c){console.error(c);return}},[a,t,e])}function m(){let{getAccessTokenSilently:e}=(0,n.D3)();return(0,r.useCallback)(async(t,a,n)=>{try{let r=await e();return await fetch(t,{...a,mode:l.yG?"cors":"no-cors",body:n?JSON.stringify(n):void 0,headers:{"Content-Type":"application/json",...a?.headers,Authorization:`Bearer ${r}`}})}catch(c){console.error(c);return}},[e])}},1635:function(e,t,a){"use strict";function n(e){return e>0?r.positiveColor:e<0?r.negativeColor:""}a.d(t,{y:function(){return n}});let r={positiveColor:"text-green-700 dark:text-green-500",negativeColor:"text-red-700 dark:text-red-500"}},515:function(e,t,a){"use strict";a.d(t,{CV:function(){return u},fK:function(){return c},p3:function(){return r},sL:function(){return o},xG:function(){return l}});var n=a(7294);function r(e){return Number.parseFloat(e.toString().replace(/[,a-zA-Z]/g,""))}function l(e,t){if(!e||Number.isNaN(e))return"0";let a=t=>e.toLocaleString("en-US",{style:"currency",currency:t,currencyDisplay:"symbol"});try{return a(t??"USD")}catch(n){if(n instanceof RangeError&&n.message.startsWith("Invalid currency code")&&t)return a("USD").replace("USD",t);return e.toString()}}function c(e,t,a,n){return e*s(t,a,n)}function s(e,t,a){let n=t?.toLowerCase(),r=a?.toLowerCase();return n&&r&&n!==r?"usd"===n?"GBp"===a?100*e.gbp:r in e?e[r]:1:"usd"!==r?s(e,t,"usd")*s(e,"usd",a):"GBp"===t?1/(100*e.gbp):n in e?1/e[n]:1:1}function o(e,t,a){return(0,n.useCallback)(n=>n*s(a,e,t),[e,a,t])}function u(e){return Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{})}Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"})},6645:function(e,t,a){"use strict";function n(e){let t=e.getFullYear(),a=""+(e.getMonth()+1),n=""+e.getDate();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[t,a,n].join("-")}a.d(t,{p:function(){return n}})},3747:function(e,t,a){"use strict";function n(e){return Object.keys(e).every(t=>void 0!==e[t])}a.d(t,{vZ:function(){return n},yG:function(){return r}});let r=!1},6076:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/accounts",function(){return a(5729)}])}},function(e){e.O(0,[774,536,427,888,179],function(){return e(e.s=6076)}),_N_E=e.O()}]);