(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{7813:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return en}});var n=a(447),r=a(7818),c=a(6508),s=a(7294),l=a(7536),o=a(2370);function u(){return(u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let m=({addAccount:e})=>{let[t,a]=(0,s.useState)(!1),{register:n,handleSubmit:m,reset:i,formState:{errors:d}}=(0,l.cI)(),p=(0,s.useCallback)(()=>a(!1),[a]),D=(0,s.useCallback)(t=>{e(t),i(),p()},[e,p,i]),y=(0,s.useId)(),{values:{currencyRates:E,preferredDisplayCurrency:f}}=(0,s.useContext)(c.Z);return s.createElement(s.Fragment,null,s.createElement("button",{onClick:()=>a(e=>!e),className:"btn btn-primary space-x-2"},s.createElement(o.RWZ,{className:"inline"}),s.createElement("span",{className:"align-middle"},"Add account")),s.createElement(r.u_,{isOpen:t,onDismiss:p},s.createElement("form",{onSubmit:m(D),className:"rounded bg-indigo-500 p-4 dark:bg-indigo-900"},s.createElement("div",{className:"pb-4"},s.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-200"},"Add new account"),s.createElement("fieldset",{className:"space-y-2"},s.createElement(r.II,u({placeholder:"Savings, Investments...",label:"Name"},n("name",{required:!0}),{errorMessage:d.name&&"Please provide a name for your account"})),s.createElement("label",{className:"flex flex-col space-y-2"},s.createElement("span",{className:"modal-form-label"},"Account type"),s.createElement("select",u({className:"modal-select"},n("type",{required:!0})),s.createElement("option",{value:"Cash"},"Cash"),s.createElement("option",{value:"Investment"},"Investment"))),s.createElement("label",{htmlFor:y,className:"flex flex-col space-y-2"},s.createElement("span",{className:"modal-form-label"},"Account currency"),s.createElement("select",u({id:y,defaultValue:f,className:"modal-select"},n("currency",{required:!0})),Object.keys(E.usd).map(e=>e.toUpperCase()).map(e=>s.createElement("option",{key:e,value:e},e)))))),s.createElement(r.qO,null,s.createElement(r.zx,{buttonType:"Transparent",onClick:p},"Cancel"),s.createElement(r.zx,{type:"submit"},"Add")))))};var i=a(6645),d=a(515),p=a(7384);let D=(0,s.createContext)({state:{accounts:[],entries:{}},dispatch(e){}});function y(){return{accounts:[],entries:{}}}function E(e,t){return(0,p.n)("account_state",f)(e,t)}function f(e,t){switch(t.type){case"RESET":return y();case"LOAD STATE":return{...t.state,accounts:t.state.accounts.sort((e,t)=>e.sortKey-t.sortKey)};case"ADD ACCOUNT":return{...e,accounts:e.accounts.concat(t.account)};case"ADD ENTRY":return e.entries[t.date]={},{...e};case"EDIT ENTRY FOR ACCOUNT":return e.entries[t.key][t.name]=t.value,e.entries=(0,d.CV)(e.entries),{...e};case"DELETE ENTRY":return delete e.entries[t.date],{...e,entries:e.entries};case"SORT ACCOUNTS":return{...e,accounts:e.accounts.map(e=>({...e,sortKey:t.order.find(t=>t.id===e.id)?.sortKey??0})).sort((e,t)=>e.sortKey-t.sortKey)};default:return console.warn(`action type not handled: ${JSON.stringify(t)}`),e}}function w(){return(w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let x=(0,s.memo)(()=>{let{dispatch:e}=(0,s.useContext)(D),[t,a]=(0,s.useState)(!1),n=(0,s.useCallback)(()=>a(!1),[a]),{register:c,handleSubmit:o}=(0,l.cI)(),u=o(({date:t})=>{e({type:"ADD ENTRY",date:t}),n()});return s.createElement(s.Fragment,null,s.createElement(r.zx,{buttonType:"Primary",onClick:()=>a(!0)},"Add entry"),s.createElement(r.u_,{isOpen:t,onDismiss:n},s.createElement("form",{onSubmit:u},s.createElement("div",{className:"p-4"},s.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-400"},"Add new entry on date"),s.createElement(r.II,w({type:"date",className:"m-4"},c("date")))),s.createElement(r.qO,null,s.createElement(r.zx,{buttonType:"Primary",type:"submit"},"Add")))))});x.displayName="AddEntryModal";var b=a(7538);let N=[{entries:[{date:new Date(Date.parse("2021-09-01")),amount:81325},{date:new Date(Date.parse("2021-11-01")),amount:89283},{date:new Date(Date.parse("2021-08-01")),amount:86219},{date:new Date(Date.parse("2021-10-01")),amount:59171},{date:new Date(Date.parse("2021-05-01")),amount:29615},{date:new Date(Date.parse("2021-04-01")),amount:49465},{date:new Date(Date.parse("2021-06-01")),amount:49589},{date:new Date(Date.parse("2021-12-01")),amount:89332},{date:new Date(Date.parse("2021-07-01")),amount:44555},{date:new Date(Date.parse("2022-01-01")),amount:89338}],id:"519486d6-41c1-4368-b6ef-678a513f6d77",name:"Cash 1",type:"Cash",currency:"USD",sortKey:0},{entries:[{date:new Date(Date.parse("2021-06-01")),amount:40259.18},{date:new Date(Date.parse("2021-11-01")),amount:5218.3},{date:new Date(Date.parse("2021-04-01")),amount:6079.73},{date:new Date(Date.parse("2021-09-01")),amount:5129},{date:new Date(Date.parse("2022-01-01")),amount:5271.17},{date:new Date(Date.parse("2021-05-01")),amount:6254.18},{date:new Date(Date.parse("2021-07-01")),amount:40280.91},{date:new Date(Date.parse("2021-12-01")),amount:5218.3},{date:new Date(Date.parse("2021-08-01")),amount:5129},{date:new Date(Date.parse("2021-10-01")),amount:5218.3}],id:"b1bb265c-1f43-4c55-be89-d45d5980f6c9",name:"Cash 2",type:"Cash",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-11-01")),amount:69239.74},{date:new Date(Date.parse("2021-10-01")),amount:84239.74},{date:new Date(Date.parse("2021-08-01")),amount:89239.74},{date:new Date(Date.parse("2021-07-01")),amount:87239.74},{date:new Date(Date.parse("2021-12-01")),amount:57266.74},{date:new Date(Date.parse("2021-06-01")),amount:72239.74},{date:new Date(Date.parse("2021-04-01")),amount:42240.63},{date:new Date(Date.parse("2021-05-01")),amount:82239.74},{date:new Date(Date.parse("2021-09-01")),amount:94239.74},{date:new Date(Date.parse("2022-01-01")),amount:52268.55}],id:"409d4daf-1e82-41e6-868f-10f7b07e4eea",name:"Cash 3",type:"Cash",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-09-01")),amount:317366},{date:new Date(Date.parse("2022-01-01")),amount:407768},{date:new Date(Date.parse("2021-04-01")),amount:208656},{date:new Date(Date.parse("2021-06-01")),amount:230487},{date:new Date(Date.parse("2021-11-01")),amount:393617},{date:new Date(Date.parse("2021-08-01")),amount:328161},{date:new Date(Date.parse("2021-10-01")),amount:346711},{date:new Date(Date.parse("2021-05-01")),amount:230433},{date:new Date(Date.parse("2021-12-01")),amount:427277},{date:new Date(Date.parse("2021-07-01")),amount:254852}],id:"35814c7b-c6c0-4d42-9999-c6a3bb5fabe5",name:"Invest 1",type:"Investment",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-12-01")),amount:82},{date:new Date(Date.parse("2021-05-01")),amount:240072},{date:new Date(Date.parse("2022-01-01")),amount:10071},{date:new Date(Date.parse("2021-07-01")),amount:200072},{date:new Date(Date.parse("2021-10-01")),amount:50072},{date:new Date(Date.parse("2021-08-01")),amount:90072},{date:new Date(Date.parse("2021-04-01")),amount:260072},{date:new Date(Date.parse("2021-11-01")),amount:30072},{date:new Date(Date.parse("2021-06-01")),amount:220072},{date:new Date(Date.parse("2021-09-01")),amount:70072}],id:"89cc16a3-1940-4fb3-bb78-759ede40006a",name:"Invest 2",type:"Investment",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-11-01")),amount:6796.32},{date:new Date(Date.parse("2021-05-01")),amount:4902.71},{date:new Date(Date.parse("2021-08-01")),amount:4354.32},{date:new Date(Date.parse("2021-09-01")),amount:6578.02},{date:new Date(Date.parse("2021-12-01")),amount:7363.61},{date:new Date(Date.parse("2021-07-01")),amount:3959.97},{date:new Date(Date.parse("2021-10-01")),amount:5821.36},{date:new Date(Date.parse("2022-01-01")),amount:6041.41},{date:new Date(Date.parse("2021-04-01")),amount:82},{date:new Date(Date.parse("2021-06-01")),amount:4630.42}],id:"d05d7e7c-120c-4d15-8f79-14bcbf24c353",name:"Invest 3",type:"Investment",currency:"USD",sortKey:1}];async function g(){if(b.xh)return Promise.resolve(N);try{let e=await fetch(`${b.ft}/account`,{method:"get",credentials:"include"}),t=await e.json();return t.map(e=>({...e,entries:e.entries.map(e=>({...e,date:new Date(Date.parse(e.date))}))}))}catch(a){return console.warn("Failed to get user's accounts"),[]}}async function h(e){return await (0,b.v_)(`${b.ft}/account`,e).then(e=>e.json())}async function v(e){await (0,b.v_)(`${b.ft}/account/entry`,e)}async function C(e){return(0,b.gz)(`${b.ft}/account`,e)}var k=a(876),O=a(8873),T=a(6077),S=a(3667),A=a(4874),I=a(8674),j=a(7398),K=a(9828);function R(){return(R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let U={xAccessor:e=>e.x,yAccessor:e=>e.y},Z=()=>{let e=(0,K.Z)(),{state:t}=(0,s.useContext)(D),{values:a}=(0,s.useContext)(c.Z),n=(0,s.useCallback)(e=>Object.keys(t.entries).map(n=>{let r=t.entries[n][e.name],c=void 0===r?void 0:(0,d.fK)(r,a.currencyRates.usd,e.currency,a.preferredDisplayCurrency);return{x:n,y:c}}),[a.currencyRates.usd,a.preferredDisplayCurrency,t.entries]),l=t.accounts.map(e=>({account:e,data:n(e)})),o=(0,s.useCallback)((e,a)=>{let n=l.filter(a).map(e=>e.data);return{name:e,data:Object.keys(t.entries).map((e,t)=>({x:e,y:n.map(e=>e[t].y??0).reduce((e,t)=>e+t,0)}))}},[l,t.entries]),u=["Cash","Investment"].map(e=>o(e,t=>t.account.type===e)).concat([o("Total",()=>!0)]),[m,i]=(0,s.useState)(!0);return s.createElement("div",{className:"py-4"},s.createElement("div",{className:"flex flex-row justify-end bg-transparent"},s.createElement("label",{className:"space-x-4 px-4"},s.createElement("span",{className:"h-full align-middle"},"Show totals"),s.createElement(r.ZD,{checked:m,onChange:e=>i(e.target.checked)}))),s.createElement(k.Z,{height:500,margin:{top:50,bottom:30,right:20,left:70},xScale:{type:"band"},yScale:{type:"linear"},theme:e?O.Z:T.Z},s.createElement(S.Z,{orientation:"bottom",hideAxisLine:!0}),s.createElement(S.Z,{orientation:"left"}),s.createElement(A.Z,{columns:!1,numTicks:4}),m?u.map(e=>s.createElement(I.Z,R({key:e.name,dataKey:e.name,data:e.data},U))):l.map(e=>s.createElement(I.Z,R({key:e.account.id,dataKey:e.account.name,data:e.data},U))),s.createElement(j.Z,{snapTooltipToDatumX:!0,snapTooltipToDatumY:!0,showVerticalCrosshair:!0,showSeriesGlyphs:!0,renderTooltip({tooltipData:e,colorScale:t}){if(e?.nearestDatum&&t)return s.createElement("div",{className:"flex flex-col"},s.createElement("div",{style:{color:t(e.nearestDatum.key)}},e.nearestDatum.key),s.createElement("span",null,U.xAccessor(e.nearestDatum.datum)),s.createElement("span",{className:"text-green-700 dark:text-green-500"},(0,d.xG)(U.yAccessor(e.nearestDatum.datum),a.preferredDisplayCurrency)))}})))};var _=a(7145),F=a.n(_),z=a(8493),G=a(6963),P=a(9272),L=a(9294);let V=({id:e,type:t,index:a,move:n,children:r,className:c})=>{let l=(0,s.useRef)(null),[{handlerId:o},u]=(0,P.L)({accept:t,collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){if(!l.current)return;let r=e.index;if(r===a)return;let c=l.current?.getBoundingClientRect(),s=(c.bottom-c.top)/2,o=t.getClientOffset(),u=o.y-c.top;r<a&&u<s||r>a&&u>s||(n(r,a),e.index=a)}},[a]),[{isDragging:m},i]=(0,L.c)(()=>({type:t,item:()=>({id:e,index:a}),collect:e=>({isDragging:!!e.isDragging()})}),[a]);return i(u(l)),s.createElement("li",{ref:l,"data-handler-id":o,className:`cursor-move ${m?"opacity-25":""} ${c||""}`},r)};var $=function({typeIdentifier:e,items:t,setItems:a,children:n,className:r}){let c=(0,s.useCallback)((e,t)=>{a(a=>F()(a,{$splice:[[e,1],[t,0,a[e]]]}))},[a]);return s.createElement(z.W,{backend:G.PD},s.createElement("ol",null,t.map((t,a)=>s.createElement(V,{key:t.id,id:t.id,index:a,move:c,type:e,className:r},n(t)))))};let Y=()=>s.createElement("svg",{className:"h-5 w-5 animate-spin text-black dark:text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},s.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})),q=({account:e})=>s.createElement("div",null,e.name),M=()=>{let{state:{accounts:e},dispatch:t}=(0,s.useContext)(D),[a,n]=(0,s.useState)(!1),[c,l]=(0,s.useState)("NONE"),[u,m]=(0,s.useState)((0,s.useMemo)(()=>e,[e])),i=(0,s.useCallback)(e=>s.createElement(q,{account:e}),[]),d=(0,s.useCallback)(async()=>{try{l("SAVING");let e=u.map((e,t)=>({id:e.id,sortKey:t,name:e.name}));await C(e),t({type:"SORT ACCOUNTS",order:e}),l("SAVED"),setTimeout(()=>l("NONE"),1e3)}catch{console.warn("Unable to save order of accounts"),l("NONE")}},[t,u]);return s.createElement(s.Fragment,null,s.createElement(r.zx,{onClick:()=>n(!0),className:"btn btn-primary flex items-center gap-x-2"},s.createElement(o.j7b,{className:"inline"}),s.createElement("span",{className:"align-middle"},"Order accounts")),s.createElement(r.u_,{isOpen:a,onDismiss:()=>n(!1)},s.createElement("div",{className:"max-h-screen w-80 max-w-full overflow-y-scroll rounded bg-slate-200 p-4 dark:bg-slate-700"},s.createElement("h2",{className:"modal-header"},"Reorder accounts"),s.createElement($,{className:"m-4 rounded bg-green-500 p-2",typeIdentifier:"ACCOUNT",items:u,setItems:m},i),s.createElement(r.qO,null,s.createElement(r.zx,{buttonType:"Secondary",onClick:()=>n(!1)},"Close"),s.createElement(r.zx,{onClick:d},"Save order"))),"NONE"!==c&&s.createElement("div",{className:"absolute top-0 left-0 z-10 flex h-full w-full flex-row items-center justify-center bg-black opacity-75"},"SAVING"===c&&s.createElement(Y,null),"SAVED"===c&&s.createElement("div",{className:"text-xl font-bold"},"Order saved!"))))};var B=a(1635);let W=({account:e,entry:t,date:a})=>{let{dispatch:n}=(0,s.useContext)(D),r=(0,s.useRef)(null),c=(0,s.useCallback)(async t=>{let r=(0,d.p3)(t.currentTarget.innerText);await v({date:a,amount:r,accountId:e.id}),n({type:"EDIT ENTRY FOR ACCOUNT",name:e.name,key:a,value:r})},[e.id,e.name,a,n]),l=(0,d.xG)(t[e.name],e.currency);return s.createElement("td",{key:e.name,contentEditable:!0,ref:r,onBlur:c,className:"px-4 text-right"},l)},X=()=>{let{state:{accounts:e,entries:t}}=(0,s.useContext)(D),a=Object.keys(t).map(a=>ee(e,t,a));return s.createElement("div",{className:"h-full overflow-x-auto pb-4"},s.createElement("table",{className:"w-full"},s.createElement(H,{accounts:e}),s.createElement("tbody",null,Object.keys(t).map((n,r)=>s.createElement("tr",{key:n,className:"whitespace-nowrap text-right font-mono odd:bg-gray-300 dark:odd:bg-gray-800"},s.createElement("td",{className:"pr-6 text-center"},n),s.createElement(J,{date:n,index:r,totals:a}),e.map(e=>s.createElement(W,{key:e.name,account:e,entry:t[n],date:n})),s.createElement(Q,{date:n}))))))},H=({accounts:e})=>s.createElement("thead",null,s.createElement("tr",{className:"whitespace-nowrap text-right"},s.createElement("th",{className:"pr-6 text-center"},"Date"),s.createElement("th",{className:"px-4 text-green-700 dark:text-green-500"},"Gain"),s.createElement("th",{className:"px-4 text-blue-700 dark:text-blue-500"},"Total"),s.createElement("th",{className:"px-4 text-yellow-700 dark:text-yellow-500"},"Total cash"),s.createElement("th",{className:"px-4 text-purple-700 dark:text-purple-500"},"Total investments"),e.map(e=>s.createElement("th",{key:e.name,className:"px-4"},s.createElement("span",null,e.name))),s.createElement("th",null))),J=({index:e,date:t,totals:a})=>{let{state:{accounts:n,entries:r}}=(0,s.useContext)(D),{values:{preferredDisplayCurrency:l}}=(0,s.useContext)(c.Z),o=0===e?0:a[e]-a[e-1],u=a[e],m=ee(n,r,t,e=>"Cash"===e.type),i=ee(n,r,t,e=>"Investment"===e.type);return s.createElement(s.Fragment,null,s.createElement("td",{className:(0,B.y)(o)},(0,d.xG)(o,l)),s.createElement("td",{className:"px-4 text-blue-700 dark:text-blue-500"},(0,d.xG)(u,l)),s.createElement("td",{className:"px-4 text-yellow-700 dark:text-yellow-500"},(0,d.xG)(m,l)),s.createElement("td",{className:"px-4 text-purple-700 dark:text-purple-500"},(0,d.xG)(i,l)))},Q=({date:e})=>{let{dispatch:t}=(0,s.useContext)(D);return s.createElement("td",{className:"pl-4"},s.createElement("button",{onClick:()=>t({type:"DELETE ENTRY",date:e}),className:"flex focus:outline-none"},s.createElement(o.BFV,{size:24,className:"text-red-700 dark:text-red-500"})))};function ee(e,t,a,n=()=>!0){let{values:{currencyRates:r,preferredDisplayCurrency:l}}=(0,s.useContext)(c.Z);return e.filter(n).map(e=>(0,d.fK)(t[a][e.name]??0,r.usd,e.currency,l)).reduce((e,t)=>e+t,0)}let et=(0,s.memo)(()=>{let[e,t]=(0,s.useReducer)(E,(0,p.v)("account_state",y()));(0,s.useEffect)(()=>{g().then(e=>{let a={};for(let n of e)for(let r of n.entries){let c=(0,i.p)(r.date);c in a||(a[c]={}),a[c][n.name]=r.amount}t({type:"LOAD STATE",state:{accounts:e,entries:Object.keys(a).sort().reduce((e,t)=>(e[t]=a[t],e),{})}})})},[]);let a=(0,s.useCallback)(async e=>{await h(e),t({type:"ADD ACCOUNT",account:e})},[t]);return s.createElement(D.Provider,{value:{state:e,dispatch:t}},s.createElement(X,null),s.createElement("div",{className:"flex flex-row justify-between px-4"},s.createElement(m,{addAccount:a}),s.createElement(M,null),s.createElement(x,null)),s.createElement(Z,null))});et.displayName="AccountOverview";let ea=()=>s.createElement(s.Fragment,null,s.createElement(n.Z,{title:"Accounts"}),s.createElement(et,null));var en=ea},447:function(e,t,a){"use strict";var n=a(9008),r=a.n(n),c=a(7294);let s=({title:e})=>{let t=`${e} | Finance`;return c.createElement(r(),null,c.createElement("title",null,t))};t.Z=s},1635:function(e,t,a){"use strict";function n(e){return e>0?r.positiveColor:e<0?r.negativeColor:""}a.d(t,{y:function(){return n}});let r={positiveColor:"text-green-700 dark:text-green-500",negativeColor:"text-red-700 dark:text-red-500"}},515:function(e,t,a){"use strict";a.d(t,{CV:function(){return u},fK:function(){return s},p3:function(){return r},sL:function(){return o},xG:function(){return c}});var n=a(7294);function r(e){return Number.parseFloat(e.toString().replace(/[,a-zA-Z]/g,""))}function c(e,t){if(!e||Number.isNaN(e))return"0";let a=t=>e.toLocaleString("en-US",{style:"currency",currency:t,currencyDisplay:"symbol"});try{return a(t??"USD")}catch(n){if(n instanceof RangeError&&n.message.startsWith("Invalid currency code")&&t)return a("USD").replace("USD",t);return e.toString()}}function s(e,t,a,n){return e*l(t,a,n)}function l(e,t,a){return(t=t?.toLowerCase(),a=a?.toLowerCase(),t&&a&&t!==a)?"usd"===t?a in e?e[a]:1:"usd"===a?t in e?1/e[t]:1:l(e,t,"usd")*l(e,"usd",a):1}function o(e,t,a){return(0,n.useCallback)(n=>n*l(a,e,t),[e,a,t])}function u(e){return Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{})}Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"})},6645:function(e,t,a){"use strict";function n(e){let t=e.getFullYear(),a=""+(e.getMonth()+1),n=""+e.getDate();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[t,a,n].join("-")}a.d(t,{p:function(){return n}})},6076:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/accounts",function(){return a(7813)}])}},function(e){e.O(0,[774,536,427,888,179],function(){return e(e.s=6076)}),_N_E=e.O()}]);