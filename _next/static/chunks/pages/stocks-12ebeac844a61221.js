(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[170],{3573:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return q}});var n=r(7294),a=r(2370),s=r(8381),c=r(7818),l=r(2283),o=r(5563);const u=`${o.NS}/${o.tW}`;const i=`${o.NS}/${o.tW}/stock`;async function m(...e){const t=await fetch(`${i}?symbols=${e.join(",")}`,{method:"GET"}),r=await t.json();if(r.error)throw new Error(r.error);return r??[]}var d,y=r(5637),p=new Uint8Array(16);function E(){if(!d&&!(d="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(p)}var b=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var f=function(e){return"string"===typeof e&&b.test(e)},k=[],g=0;g<256;++g)k.push((g+256).toString(16).substr(1));var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!f(r))throw TypeError("Stringified UUID is invalid");return r};var C=function(e,t,r){var n=(e=e||{}).random||(e.rng||E)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=n[a];return t}return h(n)};const N="stocks_state",v=(0,n.createContext)({state:x(),dispatch:e=>{}});function S(e,t){return(0,y.n)(N,w)(e,t)}function x(){const e=(0,y.v)(N,{stocks:[],preferredCurrency:"usd",currencyRates:{usd:{}}});for(const t of Object.keys(e.stocks))for(const r of e.stocks[t].lots)r.buyDate=new Date(Date.parse(r.buyDate)),r.soldDate=r.soldDate?new Date(Date.parse(r.soldDate)):void 0;return e}function w(e,t){switch(console.debug(`received action: ${t.type}`),t.type){case"ADD STOCK":return e.stocks.find((e=>e.symbol===t.stock.symbol))?e:{...e,stocks:e.stocks.concat(t.stock)};case"DELETE STOCK":return{...e,stocks:e.stocks.filter((e=>e.symbol!==t.symbol))};case"UPDATE STOCKS":return console.log(t.stocks),{...e,stocks:e.stocks.map((e=>{const r=t.stocks.find((t=>t.symbol===e.symbol));return{...e,...r,lots:e.lots}}))};case"SET STOCKS":return{...e,stocks:t.stocks.map((e=>({...e,lots:e.lots??[]})))};case"ADD LOT":{const r={id:t.lotId??C(),shares:0,buyDate:new Date,buyPrice:e.stocks.find((e=>e.symbol===t.symbol))?.regularMarketPrice??0,buyBrokerage:0};return{...e,stocks:e.stocks.map((e=>e.symbol!==t.symbol?e:{...e,lots:e.lots.concat(r)}))}}case"DELETE LOT":return{...e,stocks:e.stocks.map((e=>e.symbol!==t.symbol?e:{...e,lots:e.lots.filter((e=>e.id!==t.id))}))};case"EDIT LOT":return{...e,stocks:e.stocks.map((e=>e.symbol!==t.symbol?e:{...e,lots:e.lots.filter((e=>e.id!==t.lot.id)).concat(t.lot)}))};case"SET PREFERRED CURRENCY":return{...e,preferredCurrency:t.currency.toLowerCase()};case"SET CURRENCY RATES":return{...e,currencyRates:t.rates};default:return console.warn("action not implemented"),e}}function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var T=()=>{const{dispatch:e}=(0,n.useContext)(v),[t,r]=(0,n.useState)(!1),{register:s,handleSubmit:o,formState:{errors:i},reset:d}=(0,l.cI)(),y=(0,n.useCallback)((async t=>{const r=await m(t.symbol);0===r.length?alert(`Stock with symbol '${t.symbol}' was not found`):(await async function(e){await fetch(`${u}/stock/tracked`,{method:"POST",credentials:"include",body:e}).then((()=>console.log(`Stock tracked: ${e}`))).catch((e=>console.log(e)))}(t.symbol),e({type:"ADD STOCK",stock:{...r[0],symbol:t.symbol,lots:[]}}),d())}),[e,d]);return n.createElement(n.Fragment,null,n.createElement("button",{className:"btn btn-primary space-x-2",onClick:()=>r(!0)},n.createElement(a.RWZ,{className:"inline"}),n.createElement("span",{className:"align-middle"},"Add symbol")),n.createElement(c.u_,{isOpen:t,onDismiss:()=>r(!1)},n.createElement("div",{className:"p-4 rounded bg-gray-300 dark:bg-gray-700"},n.createElement("h3",{className:"text-lg font-bold pb-4"},"Add symbol"),n.createElement("form",{onSubmit:o(y),className:"space-y-4"},n.createElement("fieldset",{className:"space-y-2"},n.createElement(c.II,D({placeholder:"AAPL, MSFT...",label:"Symbol"},s("symbol",{required:!0}),{errorMessage:i.symbol&&"Please provide a symbol to add"}))),n.createElement(c.qO,null,n.createElement(c.zx,{type:"submit",className:"btn btn-primary ml-4 order-last"},"Add"),n.createElement(c.zx,{buttonType:"Transparent",onClick:()=>r(!1)},"Cancel"))))))};function O(...e){return e.reduce(((e,t)=>e+t),0)}function R(e){return O(...e.lots.map((e=>e.shares)))}function K(e){const t=R(e);return O(...e.lots.map((e=>e.shares*e.buyPrice)))/t}function P(e,t,r){const n=R(e),a=K(e);return(0,s.fK)(n*e.regularMarketPrice-n*a,e.currency,t,r?.usd)}var L=()=>{const{state:e,dispatch:t}=(0,n.useContext)(v),r=(0,n.useCallback)((async()=>{try{const r=await m(...e.stocks.map((e=>e.symbol)));t({type:"UPDATE STOCKS",stocks:r})}catch(r){console.error(r)}}),[e.stocks,t]);return n.createElement(c.zx,{onClick:r,className:"btn btn-primary space-x-2"},n.createElement(a.A$d,{"aria-label":"Reload current stock prices",className:"inline"}),n.createElement("span",{className:"align-middle"},"Refresh stocks"))};function j(e){return e>0?A.positiveColor:e<0?A.negativeColor:""}const A={positiveColor:"text-green-700 dark:text-green-400",negativeColor:"text-red-700 dark:text-red-400"};var $=r(9184);function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var M=({stock:e,lot:t})=>{const{dispatch:r,state:{preferredCurrency:c,currencyRates:o}}=(0,n.useContext)(v),{register:i,handleSubmit:m,watch:d}=(0,l.cI)({mode:"onChange",defaultValues:{...t,buyDate:(0,$.p)(t.buyDate)}}),y=(0,n.useCallback)((async t=>{if(""===t.buyDate)return;const n={shares:Number(t.shares),buyPrice:Number(t.buyPrice),buyDate:new Date(Date.parse(t.buyDate.toString())),buyBrokerage:0};await async function(e,t){await fetch(`${u}/stock/lot/${e}`,{method:"PUT",credentials:"include",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}(t.id,n),r({type:"EDIT LOT",symbol:e.symbol,lot:{...n,id:t.id}})}),[r,e.symbol]),p=(0,n.useCallback)((async()=>{await async function(e){await fetch(`${u}/stock/lot/${e}`,{method:"DELETE",credentials:"include",mode:"cors",headers:{"Content-Type":"application/json"}})}(t.id),r({type:"DELETE LOT",symbol:e.symbol,id:t.id})}),[r,t.id,e.symbol]),E=(0,s.sL)(e.currency,c,o.usd),b=d("shares")*e.regularMarketPrice,f=d("buyPrice")*d("shares"),k=b-f;return n.createElement("tr",{className:"odd:bg-gray-200 dark:odd:bg-gray-600"},n.createElement("td",{colSpan:3},n.createElement("form",{onChange:m(y),className:"flex flex-row justify-evenly w-full"},n.createElement("input",F({type:"date"},i("buyDate"),{className:"bg-transparent"})),n.createElement("input",F({type:"number"},i("shares"),{className:"bg-transparent w-20 text-center"})),n.createElement("input",F({type:"number"},i("buyPrice"),{className:"bg-transparent w-20 text-center"})))),n.createElement("td",{className:"text-right"},(0,s.xG)(E(b),c)),n.createElement("td",{className:`${j(k)} text-right flex flex-col`},n.createElement("span",null,(0,s.xG)(E(k),c)),n.createElement("span",null,(100*(b/f-1)).toFixed(2)," %")),n.createElement("td",{className:"pl-4"},n.createElement("button",{onClick:p},n.createElement(a.BFV,{className:"text-red-700 dark:text-red-500",size:24}))))};var _=({lots:e,stock:t})=>{const{dispatch:r}=(0,n.useContext)(v),s=(0,n.useCallback)((async()=>{const e=await(n={symbol:t.symbol,shares:0,buyDate:new Date,buyPrice:0,buyBrokerage:0},fetch(`${u}/stock/lot`,{method:"POST",credentials:"include",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())));var n;r({type:"ADD LOT",symbol:t.symbol,lotId:e})}),[r,t]);return n.createElement(n.Fragment,null,n.createElement("h3",{className:"text-center text-2xl text-green-700 dark:text-green-400"},"Lots for ",t.displayName??t.symbol),n.createElement("div",{className:"bg-gray-300 dark:bg-gray-700 rounded shadow mx-8"},n.createElement("table",{className:"w-full"},n.createElement("thead",null,n.createElement("tr",null,n.createElement("th",null,"Buy date"),n.createElement("th",null,"Shares"),n.createElement("th",null,"Buy price"),n.createElement("th",null,"Market value"),n.createElement("th",null,"Total gain"))),n.createElement("tbody",null,e.map((e=>n.createElement(M,{key:e.id,lot:e,stock:t}))))),n.createElement("div",{className:"p-4"},n.createElement(c.zx,{onClick:s,className:"space-x-2 btn btn-primary"},n.createElement(a.RWZ,{className:"inline"}),n.createElement("span",{className:"align-middle"},"Add lot")))))};var G=({stock:e})=>{const{state:{preferredCurrency:t,currencyRates:r}}=(0,n.useContext)(v),a=(0,s.sL)(e.currency,t,r.usd),c=R(e),l=K(e),o=l*c,u=e.regularMarketPrice*c,i=P(e,t,r),m=100*(u/o-1),[d,y]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement("tr",{className:"w-full relative text-right bg-gray-200 dark:bg-gray-800"},n.createElement("td",{className:"text-left px-4"},e.symbol),n.createElement("td",null,(0,s.xG)(e.regularMarketPrice,e.currency)),n.createElement("td",null,(0,s.xG)(a(u),t)),n.createElement("td",null,c),n.createElement("td",{className:j(l)},(0,s.xG)(l,e.currency)),n.createElement("td",{className:`${j(i)} flex flex-col`},n.createElement("span",null,(0,s.xG)(i,t)),n.createElement("span",{className:isNaN(m)?"hidden":""},m.toFixed(2),"%")),n.createElement(U,{stock:e,setShowLots:y})),n.createElement("tr",null,n.createElement("td",{colSpan:7,className:"p-0 pb-4 "+(d?"":"hidden")},n.createElement(_,{lots:e.lots,stock:e}))))};const U=({stock:e,setShowLots:t})=>{const{dispatch:r}=(0,n.useContext)(v),s=(0,n.useCallback)((()=>{r({type:"DELETE STOCK",symbol:e.symbol})}),[r,e.symbol]);return n.createElement("td",{className:"h-full space-x-2 pr-4"},n.createElement("button",{onClick:()=>t((e=>!e)),className:"hover:cursor-pointer"},n.createElement(a.XSk,{size:24})),n.createElement("button",{onClick:s,className:"hover:cursor-pointer"},n.createElement(a.BFV,{className:"text-red-500",size:24})))};var I=()=>{const{state:{preferredCurrency:e,currencyRates:t},dispatch:r}=(0,n.useContext)(v),[s,l]=(0,n.useState)(!1),o=(0,n.useCallback)((()=>l(!0)),[l]),u=(0,n.useCallback)((e=>{const t=e.currentTarget.value;t&&r({type:"SET PREFERRED CURRENCY",currency:t})}),[r]);return n.createElement(n.Fragment,null,n.createElement("button",{className:"btn btn-secondary",onClick:o},n.createElement(a.Fuo,null)),n.createElement(c.u_,{isOpen:s,onDismiss:()=>l(!1)},n.createElement("div",{className:"p-4 dark:bg-gray-900"},n.createElement("h2",{className:"font-bold text-lg"},"Stock settings"),n.createElement("div",{className:"grid grid-cols-2 gap-8"},n.createElement("label",null,"Preferred currency"),n.createElement("select",{onChange:u,defaultValue:e,className:"rounded dark:bg-gray-700"},Object.keys(t.usd).map((e=>n.createElement("option",{key:e,value:e},e.toLocaleUpperCase()))))),n.createElement(c.qO,{className:"mt-4"},n.createElement("button",{onClick:()=>l(!1),className:"btn btn-primary space-x-2"},n.createElement(a.Jvf,{size:24,className:"inline"}),n.createElement("span",{className:"align-middle"},"Close"))))))};var z=({stocks:e})=>{const{state:{preferredCurrency:t,currencyRates:r}}=(0,n.useContext)(v),a=(0,n.useMemo)((()=>O(...e.flatMap((e=>e.lots.map((n=>(0,s.fK)(e.regularMarketPrice*n.shares,e.currency,t,r.usd))))))),[r.usd,t,e]),c=(0,n.useMemo)((()=>O(...e.flatMap((e=>e.lots.map((n=>(0,s.fK)(e.regularMarketPrice*n.shares-n.buyPrice*n.shares,e.currency,t,r.usd))))))),[r.usd,t,e]);return n.createElement("tr",{className:"text-right font-bold dark:text-purple-400"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null,(0,s.xG)(a,t)),n.createElement("td",null),n.createElement("td",null),n.createElement("td",null,(0,s.xG)(c,t)))};var V=()=>{const[e,t]=(0,n.useReducer)(S,x());return(0,n.useEffect)((()=>{(function(e="usd"){return fetch(function(e){return`https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/${e}.min.json`}(e)).then((async e=>await e.json()))})().then((e=>t({type:"SET CURRENCY RATES",rates:e}))).catch((e=>console.warn(e)))}),[]),(0,n.useEffect)((()=>{fetch(`${u}/stock/tracked`,{credentials:"include"}).then((async e=>await e.json())).then((e=>e.map((e=>({...e,lots:e.lots.map((e=>({...e,buyDate:new Date(Date.parse(e.buyDate)),soldDate:e.soldDate?new Date(Date.parse(e.soldDate)):void 0})))}))))).then((e=>t({type:"SET STOCKS",stocks:e}))).then((async()=>{const r=await m(...e.stocks.map((e=>e.symbol)));t({type:"UPDATE STOCKS",stocks:r})}))}),[]),n.createElement(v.Provider,{value:{state:e,dispatch:t}},n.createElement("h2",{className:"text-xl px-4 py-4"},"Stocks"),n.createElement(B,{stocks:e.stocks}),n.createElement(J,null))};const B=({stocks:e,currencyRates:t,preferredCurrency:r})=>{const[a,c]=(0,n.useState)(),[l,o]=(0,n.useState)(!1),u=(0,n.useCallback)((e=>()=>{a===e?o((e=>!e)):c(e)}),[c,o,a]);return n.createElement("div",{className:"overflow-x-scroll"},n.createElement("table",{className:"w-full"},n.createElement("thead",null,n.createElement("tr",{className:"text-sm align-bottom text-gray-600 dark:text-gray-400"},n.createElement(Y,{sort:u,currentSortKey:a,sortKey:"Symbol",ascending:l},"Symbol"),n.createElement(Y,{sort:u,currentSortKey:a,sortKey:"Current price",ascending:l},"Current price"),n.createElement(Y,{sort:u,currentSortKey:a,sortKey:"Total value",ascending:l},"Total value"),n.createElement(Y,{sort:u,currentSortKey:a,sortKey:"Total shares",ascending:l},"Total shares"),n.createElement(Y,{sort:u,currentSortKey:a,sortKey:"Average price",ascending:l},"Average price"),n.createElement(Y,{sort:u,currentSortKey:a,sortKey:"Gain",ascending:l},"Gain"))),n.createElement("tbody",null,e.sort(function(e,t,r,n){if(!e)return()=>0;const a=e=>(0,s.fK)(e.regularMarketPrice,e.currency,r,n?.usd);return(c,l)=>{let o=0;switch(e){case"Symbol":o=c.symbol.localeCompare(l.symbol);break;case"Gain":o=P(c,r,n)-P(l,r,n);break;case"Average price":o=(0,s.fK)(K(c),c.currency,r,n?.usd)-(0,s.fK)(K(l),l.currency,r,n?.usd);break;case"Current price":o=a(c)-a(l);break;case"Total shares":o=R(c)-R(l);break;case"Total value":o=a(c)*R(c)-a(l)*R(l)}return o*(t?1:-1)}}(a,l,r,t)).map((e=>n.createElement(G,{key:e.symbol,stock:e})))),n.createElement("tfoot",null,n.createElement(z,{stocks:e}))))},J=()=>n.createElement("div",{className:"p-4 justify-between flex"},n.createElement(T,null),n.createElement(L,null),n.createElement(I,null)),Y=({sort:e,children:t,currentSortKey:r,sortKey:a,ascending:s})=>n.createElement("th",null,n.createElement("button",{onClick:e(a),className:"px-2 focus:ring-1 ring-red-800 dark:ring-red-600 rounded-sm"},t,a===r&&n.createElement(Z,{ascending:s}))),Z=({ascending:e})=>n.createElement(n.Fragment,null,e?n.createElement(a.lmx,{className:"inline"}):n.createElement(a.Gal,{className:"inline"}));var W=r(7515);var q=()=>n.createElement(n.Fragment,null,n.createElement(W.Z,{title:"Stocks"}),n.createElement(V,null))},7515:function(e,t,r){"use strict";var n=r(9008),a=r(7294);t.Z=({title:e})=>a.createElement(n.default,null,a.createElement("title",null,e," | Finance"))},8381:function(e,t,r){"use strict";r.d(t,{p3:function(){return a},oB:function(){return s},xG:function(){return c},fK:function(){return l},sL:function(){return u},CV:function(){return m}});var n=r(7294);function a(e){return Number.parseFloat(e.toString().replace(/[,a-zA-Z]/g,""))}const s=Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"});function c(e,t){return Number.isNaN(e)?"-":e.toLocaleString(void 0,{style:"currency",currency:t??"USD",currencyDisplay:"code"})}function l(e,t,r,n){return e*o(t,r,n)}function o(e,t,r){const n="usd";return e=e?.toLowerCase(),t=t?.toLowerCase(),r=r??i,e&&t&&e!==t?e===n?t in r?r[t]:1:t===n?e in r?1/r[e]:1:o(e,n)*o(n,t):1}function u(e,t,r){return(0,n.useCallback)((n=>l(n,e,t,r)),[e,r,t])}const i={dkk:6.36,nok:9,eur:.85};function m(e){return Object.keys(e).sort().reduce(((t,r)=>(t[r]=e[r],t)),{})}},9184:function(e,t,r){"use strict";function n(e){const t=e.getFullYear();let r=""+(e.getMonth()+1),n=""+e.getDate();return r.length<2&&(r="0"+r),n.length<2&&(n="0"+n),[t,r,n].join("-")}r.d(t,{p:function(){return n}})},5637:function(e,t,r){"use strict";function n(e,t={}){const r=localStorage.getItem(e)??void 0;return{...t,...void 0===r||""===r?{}:JSON.parse(r)}}function a(e,t){return(r,n)=>{const a=t(r,n);return localStorage.setItem(e,JSON.stringify(a)),a}}r.d(t,{v:function(){return n},n:function(){return a}})},9433:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stocks",function(){return r(3573)}])}},function(e){e.O(0,[283,888,774,179],(function(){return t=9433,e(e.s=t);var t}));var t=e.O();_N_E=t}]);