(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{5343:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var n=a(447),r=a(7294),l=a(6535),c=a(3747),s=a(7538);let u=c.yG?"http://localhost:4000":"https://finance.oliverflecke.me/api/v1";var m=a(7384);let i=r.createContext({state:o(),dispatch(e){}});function o(){return(0,m.v)("budget",{hideItems:!1})}let d=({setSavePercent:e})=>{let{state:{hideItems:t},dispatch:a}=(0,r.useContext)(i);return r.createElement("div",{className:"mx-4 mt-2 rounded bg-sky-300 p-4 dark:bg-sky-900"},r.createElement("label",{htmlFor:"desired-savings"},"Desired savings"),r.createElement("span",{className:"mx-4 rounded bg-slate-200 py-1 px-2 shadow-md focus-within:ring-2 dark:bg-slate-800"},r.createElement("input",{className:"w-12 bg-transparent pr-2 text-right outline-none dark:placeholder-slate-600",placeholder:"15",name:"desired-savings",type:"number",min:"0",max:"100",onKeyDown(e){if(!/[0-9\.,\b]/.test(e.key)&&"Backspace"!==e.key&&"Delete"!==e.key){e.preventDefault();return}},onChange:t=>e(Number.parseFloat(t.currentTarget.value))}),"%"),r.createElement("label",{className:"space-x-4"},r.createElement("span",null,"Hide items"),r.createElement("input",{type:"checkbox",checked:t,onChange:e=>a({type:"HIDE ITEMS",value:e.target.checked})})))};var E=a(2308),g=a(8574),b=a(515);let p=({value:e})=>r.createElement(r.Fragment,null,r.createElement("td",{className:"currency"},(0,b.xG)(e,B)),r.createElement("td",{className:"currency"},(0,b.xG)(12*e,B)));var f=a(2370),y=a(7536),x=a(7818);function h(){return(h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let k=({update:e,item:t})=>{let{register:a,handleSubmit:n}=(0,y.cI)({defaultValues:t}),l=(0,r.useCallback)(a=>{e(t.id,a)},[t.id,e]);return r.createElement("form",{onSubmit:n(l),className:"flex w-96 max-w-screen-lg flex-col space-y-4 rounded bg-indigo-500 p-4 dark:bg-indigo-900"},r.createElement("h4",{className:"text-xl"},"Edit item"),r.createElement("label",{className:"edit-item"},r.createElement("span",null,"Category"),r.createElement("input",h({placeholder:"Category",className:"budget edit-item"},a("category",{required:!0})))),r.createElement("label",{className:"edit-item"},r.createElement("span",null,"Name"),r.createElement("input",h({placeholder:"Name",className:"budget edit-item"},a("name",{required:!0})))),r.createElement("label",{className:"edit-item"},r.createElement("span",null,"Amount"),r.createElement("input",h({placeholder:"Amount",className:"budget edit-item",onKeyDown(e){/\d|\.|Enter|Shift|Tab|Arrow*|-|Backspace/.test(e.key)||e.preventDefault()}},a("amount",{required:!0,valueAsNumber:!0})))),r.createElement(x.qO,null,r.createElement(x.zx,{buttonType:"Transparent"},"Cancel"),r.createElement(x.zx,{type:"submit",buttonType:"Primary",className:"btn btn-primary flex items-center justify-center space-x-2 align-middle"},r.createElement("span",null,"Save"),r.createElement(f.Tri,null))))};function N({onClick:e}){return r.createElement("button",{onClick:e,className:"flex focus:outline-none"},r.createElement(f.RWZ,{size:24,className:"text-green-700 dark:text-green-500"}))}function v(){return(v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let w=({add:e})=>{let{register:t,handleSubmit:a}=(0,y.cI)();return r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",{colSpan:4},r.createElement("form",{onSubmit:a(e),className:"flex flex-wrap justify-end space-x-2 pb-4 pt-2"},r.createElement("input",v({placeholder:"Category",className:"budget add-item"},t("category",{required:!0}))),r.createElement("input",v({placeholder:"Name",className:"budget add-item"},t("name",{required:!0}))),r.createElement("input",v({placeholder:"Amount",className:"budget add-item",onKeyDown(e){/\d|\.|Enter|Shift|Tab/.test(e.key)||e.preventDefault()}},t("amount",{required:!0,valueAsNumber:!0}))),r.createElement("button",{type:"submit",className:"btn btn-primary flex items-center space-x-2 align-middle"},r.createElement("span",null,"Add"),r.createElement(f.RWZ,{size:24,className:"text-green-400 dark:text-green-500"}))))))};function C({onClick:e}){return r.createElement("button",{onClick:e,className:"flex focus:outline-none"},r.createElement(f.MPJ,{size:24,className:"text-red-700 dark:text-red-500"}))}let S=({title:e,items:t,total:a,addItem:n,deleteItem:l,updateItem:c})=>{let{state:{hideItems:s}}=(0,r.useContext)(i),u=(0,r.useMemo)(()=>Array.from(function*(e){let t=new Map;for(let a of e){let n=t.get(a.category)??[];n.push(a),t.set(a.category,n)}for(let[r,l]of t)yield{category:r,items:l}}(t)),[t]),[m,o]=(0,r.useState)(!1);return r.createElement(r.Fragment,null,r.createElement("tbody",null,r.createElement("tr",null,r.createElement("th",{className:"text-left text-xl underline"},e)),u.map(e=>r.createElement(r.Fragment,{key:e.category},r.createElement("tr",{key:e.category,className:`font-bold text-fuchsia-700 dark:text-fuchsia-500 ${s?"odd:bg-slate-200 dark:odd:bg-slate-700":""}`},r.createElement("th",{className:"px-4 text-left"},e.category),r.createElement(p,{value:Math.abs((0,E.S)(...e.items.map(e=>e.amount)))}),r.createElement("td",null)),!s&&e.items.map(e=>r.createElement("tr",{key:e.name,className:"px-8 odd:bg-slate-200 dark:odd:bg-slate-700"},r.createElement("td",{className:"pl-8"},e.name),r.createElement(p,{value:Math.abs(e.amount)}),r.createElement(D,{item:e,deleteItem:l,updateItem:c}))))),r.createElement("tr",null,r.createElement("th",{className:"text-left"},"Total"),r.createElement("th",{className:"currency"},(0,b.xG)(a,B)),r.createElement("th",{className:"currency"},(0,b.xG)(12*a,B)),r.createElement("th",{className:"flex flex-row justify-end pr-4"},m?r.createElement(C,{onClick:()=>o(!1)}):r.createElement(N,{onClick:()=>o(!0)})))),m&&r.createElement(w,{add:n}))},D=({item:e,deleteItem:t,updateItem:a})=>{let[n,l]=(0,r.useState)(!1),c=(0,r.useCallback)((e,t)=>{a(e,t),l(!1)},[a,l]);return r.createElement("td",{className:"flex flex-row justify-end space-x-2 pr-4"},r.createElement(g.Z,{onClick:()=>t(e.id)}),r.createElement("button",{onClick:()=>l(!0),className:"text-green-700 dark:text-green-400"},r.createElement(f.orQ,{size:24})),r.createElement(x.u_,{isOpen:n,onDismiss:()=>l(!1)},r.createElement(k,{item:e,update:c})))};var I=a(1635);let T=({budget:e,savePercent:t})=>{let{dispatch:a}=(0,r.useContext)(i),{income:n,expenses:l,total:c,totalIncome:s,totalExpenses:u,savings:m,remaining:o}=function(e,{savePercent:t}){let a=(0,r.useMemo)(()=>e.items.filter(e=>e.amount>=0),[e.items]),n=(0,r.useMemo)(()=>e.items.filter(e=>e.amount<0),[e.items]),l=(0,r.useMemo)(()=>(0,E.S)(...a.map(e=>e.amount)),[a]),c=(0,r.useMemo)(()=>-(0,E.S)(...n.map(e=>e.amount)),[n]),s=(0,r.useMemo)(()=>l-c,[l,c]),u=l*(t/100);return{income:a,expenses:n,total:s,totalIncome:l,totalExpenses:c,savings:u,remaining:s-u}}(e,{savePercent:t}),{deleteItem:d,updateItem:g,addItem:b,addExpense:p}=function(e,t){let a=(0,r.useCallback)(a=>{e({type:"REMOVE ITEM",budget_id:t,item_id:a})},[t,e]),n=(0,r.useCallback)((t,a)=>{e({type:"EDIT ITEM",item_id:t,item:a})},[e]),l=(0,r.useCallback)(a=>e({type:"ADD INCOME",budget_id:t,item:a}),[t,e]),c=(0,r.useCallback)(a=>{a.amount=-a.amount,e({type:"ADD EXPENSE",budget_id:t,item:a})},[t,e]);return{deleteItem:a,updateItem:n,addItem:l,addExpense:c}}(a,e.id);return r.createElement("div",{className:"mx-4 pb-8"},r.createElement("table",{className:"w-full border-separate border-spacing-0 overflow-hidden rounded"},r.createElement(O,null),r.createElement(S,{title:"Income",items:n,total:s,addItem:b,deleteItem:d,updateItem:g}),r.createElement(S,{title:"Expenses",items:l,total:u,addItem:p,deleteItem:d,updateItem:g}),r.createElement(_,{total:c,savings:m,remaining:o})))},_=({total:e,savings:t,remaining:a})=>r.createElement("tfoot",{className:"bg-sky-300 dark:bg-sky-900"},r.createElement("tr",{className:(0,I.yZ)(e)},r.createElement("th",{className:"px-4 py-1 text-left"},"After monthley expenses"),r.createElement(p,{value:e}),r.createElement("td",null)),r.createElement("tr",null,r.createElement("td",{className:"px-4 py-1 text-left"},"Savings"),r.createElement(p,{value:t}),r.createElement("td",null)),r.createElement("tr",{className:(0,I.yZ)(a)},r.createElement("th",{className:"px-4 py-1 text-left"},"Remaining"),r.createElement(p,{value:a}),r.createElement("td",null))),O=()=>r.createElement("thead",null,r.createElement("tr",{className:"text-right"},r.createElement("th",{className:"px-2"}),r.createElement("th",{className:"px-2"},"Per month"),r.createElement("th",{className:"px-2"},"Per year")));function M(){return(M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let P=({onBudgetCreated:e})=>{let t=(0,s.ku)(`${u}/budget`,{method:"POST"}),{register:a,handleSubmit:n}=(0,y.cI)(),l=(0,r.useCallback)(async a=>{console.log(`Creating budget with name: ${a.title}`),await t(a),e()},[t,e]);return r.createElement("div",{className:"flex max-w-lg flex-col space-y-2 rounded bg-sky-300 p-4 dark:bg-sky-900"},r.createElement("h3",{className:"text-lg"},"New budget"),r.createElement("form",{onSubmit:n(l),className:"flex flex-col space-y-4"},r.createElement("label",{className:"flex flex-col items-baseline"},r.createElement("span",{className:"text-md text-gray-700 dark:text-gray-100"},"Title"),r.createElement(x.II,M({},a("title"),{placeholder:"My budget"}))),r.createElement("input",{type:"submit",value:"Create",className:"btn btn-success w-full"})))},$=()=>{let{dispatch:e}=(0,r.useContext)(i),t=(0,s.h_)(`${u}/budget`,{method:"GET"}),a=function(){let e=(0,s.t1)();return(0,r.useCallback)(t=>e(`${u}/budget/${t}`,{method:"DELETE"}),[e])}(),n=function(){let e=(0,s.t1)();return(0,r.useCallback)(async t=>{let a=await e(`${u}/budget/${t}`,{method:"GET"}),n=await a?.text();return n?(0,s.S5)(n):null},[e])}(),l=(0,r.useCallback)(async t=>{let a=await n(t.id);a&&e({type:"SET BUDGET",budget:a})},[e,n]),c=(0,r.useCallback)(async e=>{await a(e),t.refresh()},[t,a]),[m,o]=(0,r.useState)(!1);return r.createElement(r.Fragment,null,r.createElement("div",{className:"bg-sky-300 p-4 dark:bg-sky-900"},r.createElement("div",{className:"flex w-full flex-row justify-between space-x-4 font-bold text-gray-800 dark:text-gray-300"},r.createElement("span",null,"Title"),r.createElement("span",null,"Created at"),r.createElement("span",null)),t.data&&r.createElement("ul",null,t.data?.map(e=>r.createElement(j,{key:`${e.title}-${e.created_at.toISOString()}`,budget:e,deleteCallback:c,onSelect:l}))),r.createElement("div",{className:"flex-end flex w-full"},r.createElement(N,{onClick:()=>o(!0)})),r.createElement(x.u_,{isOpen:m,onDismiss:()=>o(!1)},r.createElement(P,{onBudgetCreated:t.refresh}))))},j=({budget:e,deleteCallback:t,onSelect:a})=>r.createElement("li",{className:"flex w-full flex-row justify-between space-x-4 rounded px-4 odd:bg-slate-200 dark:odd:bg-slate-800"},r.createElement("span",{onClick:()=>a(e),className:"hover:cursor-pointer"},e.title),r.createElement("span",null,e.created_at.toDateString()),r.createElement("span",null,r.createElement(g.Z,{onClick:()=>t(e.id)}))),B="GBP",F=()=>{let e=function(){let e=(0,s.t1)();return(0,r.useCallback)(async(t,a)=>{let n=await e(`${u}/budget/${t}/item`,{method:"POST"},a);if(!n?.ok)throw Error(await n?.text());return await n.text()},[e])}(),t=function(){let e=(0,s.t1)();return(0,r.useCallback)(async(t,a)=>{let n=await e(`${u}/budget/${t}/item/${a}`,{method:"DELETE"});if(!n?.ok)throw Error(await n?.text())},[e])}(),a=function(){let e=(0,s.t1)();return(0,r.useCallback)(async(t,a,n)=>{let r=await e(`${u}/budget/${t}/item/${a}`,{method:"PUT"},n);if(!r?.ok)throw Error(await r?.text())},[e])}(),n=(0,r.useMemo)(()=>{var n;return n={addItemToBudgetCallback:e,deleteItemFromBudgetCallback:t,updateItemCallback:a},async(e,t)=>{switch(t.type){case"HIDE ITEMS":return{...e,hideItems:t.value};case"ADD EXPENSE":case"ADD INCOME":if(!e.budget)throw Error("No budget has been selected");let a=await n.addItemToBudgetCallback(t.budget_id,t.item),r=new Date(Date.now()),l={...t.item,created_at:r,modified_at:r,id:a,budget_id:t.budget_id};return console.log(e.budget.items),console.log(e.budget.items.concat(l)),{...e,budget:{...e.budget,items:e.budget.items.concat(l)}};case"REMOVE ITEM":if(!e.budget)throw Error("No budget has been selected");return await n.deleteItemFromBudgetCallback(t.budget_id,t.item_id),{...e,budget:{...e.budget,items:e.budget.items.filter(e=>e.id!==t.item_id)}};case"EDIT ITEM":if(!e.budget)throw Error("No budget has been selected");return await n.updateItemCallback(e.budget.id,t.item_id,t.item),{...e,budget:{...e.budget,items:e.budget.items.map(e=>e.id===t.item_id?{...e,...t.item}:e)}};case"SET BUDGET":return{...e,budget:t.budget};default:return console.warn(`Unhandled action: ${t}`),Promise.resolve(e)}}},[e,t,a]);return r.createElement(A,{reducer:n})},A=({reducer:e})=>{let[t,a]=function(e,t,a){let[n,l]=(0,r.useState)({...t,loading:!1,error:null}),c=(0,r.useCallback)(e=>{a&&localStorage.setItem(a,JSON.stringify(e)),l(e)},[a,l]),s=(0,r.useCallback)(async t=>{let a=e(n,t);a instanceof Promise?(l({...n,loading:!0,error:null}),a.then(e=>c({...e,loading:!1,error:null})).catch(e=>l({...n,loading:!1,error:e}))):c({...a,loading:!1,error:null})},[c,e,n]);return[n,s]}(e,o(),"budget"),[n,c]=(0,r.useState)(0);return r.createElement(r.Fragment,null,r.createElement(i.Provider,{value:{state:t,dispatch:a}},r.createElement($,null),r.createElement(l.Z,null,t.budget&&r.createElement(r.Fragment,null,r.createElement("h3",{className:" px-4 pt-6 text-3xl text-fuchsia-700 dark:text-fuchsia-600"},t.budget.title),r.createElement(d,{setSavePercent:c}),r.createElement(T,{budget:t.budget,savePercent:n})))))},G=()=>r.createElement(r.Fragment,null,r.createElement(n.Z,{title:"Budget"}),r.createElement(F,null));var Z=G},8574:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n=a(7294),r=a(2370);function l({onClick:e}){return n.createElement("button",{onClick:e,className:"flex focus:outline-none"},n.createElement(r.BFV,{size:24,className:"text-red-700 dark:text-red-500"}))}},447:function(e,t,a){"use strict";var n=a(9008),r=a.n(n),l=a(7294);let c=({title:e})=>{let t=`${e} | Finance`;return l.createElement(r(),null,l.createElement("title",null,t))};t.Z=c},1635:function(e,t,a){"use strict";function n(e){return e>0?l.positiveColor:e<0?l.negativeColor:""}function r(e){return e>0?l.positiveBackground:e<0?l.positiveBackground:""}a.d(t,{yY:function(){return n},yZ:function(){return r}});let l={positiveColor:"text-green-700 dark:text-green-500",negativeColor:"text-red-700 dark:text-red-500",positiveBackground:"bg-green-400 dark:bg-green-700",negativeBackground:"bg-red-400 dark:bg-red-700"}},515:function(e,t,a){"use strict";a.d(t,{CV:function(){return m},fK:function(){return c},p3:function(){return r},sL:function(){return u},xG:function(){return l}});var n=a(7294);function r(e){return Number.parseFloat(e.toString().replace(/[^.\d]/g,""))}function l(e,t){if(!e||Number.isNaN(e))return"0";let a=t=>e.toLocaleString("en-US",{style:"currency",currency:t,currencyDisplay:"symbol"});try{return a(t??"USD")}catch(n){if(n instanceof RangeError&&n.message.startsWith("Invalid currency code")&&t)return a("USD").replace("USD",t);return e.toString()}}function c(e,t,a,n){return e*s(t,a,n)}function s(e,t,a){let n=t?.toLowerCase(),r=a?.toLowerCase();return n&&r&&n!==r?"usd"===n?"GBp"===a?100*e.gbp:r in e?e[r]:1:"usd"!==r?s(e,t,"usd")*s(e,"usd",a):"GBp"===t?1/(100*e.gbp):n in e?1/e[n]:1:1}function u(e,t,a){return(0,n.useCallback)(n=>n*s(a,e,t),[e,a,t])}function m(e){return Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{})}Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"})},2308:function(e,t,a){"use strict";function n(...e){return e.reduce((e,t)=>e+t,0)}a.d(t,{S:function(){return n}})},9142:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/budget",function(){return a(5343)}])}},function(e){e.O(0,[536,888,774,179],function(){return e(e.s=9142)}),_N_E=e.O()}]);