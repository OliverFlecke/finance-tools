(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{9532:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return en}});var n=a(7294),r=a(7818),c=a(6508),s=a(7536),l=a(2370);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let u=({addAccount:e})=>{let[t,a]=(0,n.useState)(!1),{register:u,handleSubmit:m,reset:i,formState:{errors:d}}=(0,s.cI)(),p=(0,n.useCallback)(()=>a(!1),[a]),D=(0,n.useCallback)(t=>{e(t),i(),p()},[e,p,i]),y=(0,n.useId)(),{values:{currencyRates:E,preferredDisplayCurrency:f}}=(0,n.useContext)(c.Z);return n.createElement(n.Fragment,null,n.createElement("button",{onClick:()=>a(e=>!e),className:"btn btn-primary space-x-2"},n.createElement(l.RWZ,{className:"inline"}),n.createElement("span",{className:"align-middle"},"Add account")),n.createElement(r.u_,{isOpen:t,onDismiss:p},n.createElement("form",{onSubmit:m(D),className:"rounded bg-indigo-500 p-4 dark:bg-indigo-900"},n.createElement("div",{className:"pb-4"},n.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-200"},"Add new account"),n.createElement("fieldset",{className:"space-y-2"},n.createElement(r.II,o({placeholder:"Savings, Investments...",label:"Name"},u("name",{required:!0}),{errorMessage:d.name&&"Please provide a name for your account"})),n.createElement("label",{className:"flex flex-col space-y-2"},n.createElement("span",{className:"modal-form-label"},"Account type"),n.createElement("select",o({className:"modal-select"},u("type",{required:!0})),n.createElement("option",{value:"Cash"},"Cash"),n.createElement("option",{value:"Investment"},"Investment"))),n.createElement("label",{htmlFor:y,className:"flex flex-col space-y-2"},n.createElement("span",{className:"modal-form-label"},"Account currency"),n.createElement("select",o({id:y,defaultValue:f,className:"modal-select"},u("currency",{required:!0})),Object.keys(E.usd).map(e=>e.toUpperCase()).map(e=>n.createElement("option",{key:e,value:e},e)))))),n.createElement(r.qO,null,n.createElement(r.zx,{buttonType:"Transparent",onClick:p},"Cancel"),n.createElement(r.zx,{type:"submit"},"Add")))))};var m=a(6645),i=a(515),d=a(7384);let p=(0,n.createContext)({state:{accounts:[],entries:{}},dispatch(e){}});function D(){return{accounts:[],entries:{}}}function y(e,t){return(0,d.n)("account_state",E)(e,t)}function E(e,t){switch(t.type){case"RESET":return D();case"LOAD STATE":return{...t.state,accounts:t.state.accounts.sort((e,t)=>e.sortKey-t.sortKey)};case"ADD ACCOUNT":return{...e,accounts:e.accounts.concat(t.account)};case"ADD ENTRY":return e.entries[t.date]={},{...e};case"EDIT ENTRY FOR ACCOUNT":return e.entries[t.key][t.name]=t.value,e.entries=(0,i.CV)(e.entries),{...e};case"DELETE ENTRY":return delete e.entries[t.date],{...e,entries:e.entries};case"SORT ACCOUNTS":return{...e,accounts:e.accounts.map(e=>({...e,sortKey:t.order.find(t=>t.id===e.id)?.sortKey??0})).sort((e,t)=>e.sortKey-t.sortKey)};default:return console.warn(`action type not handled: ${JSON.stringify(t)}`),e}}function f(){return(f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let w=(0,n.memo)(()=>{let{dispatch:e}=(0,n.useContext)(p),[t,a]=(0,n.useState)(!1),c=(0,n.useCallback)(()=>a(!1),[a]),{register:l,handleSubmit:o}=(0,s.cI)(),u=o(({date:t})=>{e({type:"ADD ENTRY",date:t}),c()});return n.createElement(n.Fragment,null,n.createElement(r.zx,{buttonType:"Primary",onClick:()=>a(!0)},"Add entry"),n.createElement(r.u_,{isOpen:t,onDismiss:c},n.createElement("form",{onSubmit:u},n.createElement("div",{className:"p-4"},n.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-400"},"Add new entry on date"),n.createElement(r.II,f({type:"date",className:"m-4"},l("date")))),n.createElement(r.qO,null,n.createElement(r.zx,{buttonType:"Primary",type:"submit"},"Add")))))});w.displayName="AddEntryModal";var x=a(7538);let b=[{entries:[{date:new Date(Date.parse("2021-09-01")),amount:81325},{date:new Date(Date.parse("2021-11-01")),amount:89283},{date:new Date(Date.parse("2021-08-01")),amount:86219},{date:new Date(Date.parse("2021-10-01")),amount:59171},{date:new Date(Date.parse("2021-05-01")),amount:29615},{date:new Date(Date.parse("2021-04-01")),amount:49465},{date:new Date(Date.parse("2021-06-01")),amount:49589},{date:new Date(Date.parse("2021-12-01")),amount:89332},{date:new Date(Date.parse("2021-07-01")),amount:44555},{date:new Date(Date.parse("2022-01-01")),amount:89338}],id:"519486d6-41c1-4368-b6ef-678a513f6d77",name:"Cash 1",type:"Cash",currency:"USD",sortKey:0},{entries:[{date:new Date(Date.parse("2021-06-01")),amount:40259.18},{date:new Date(Date.parse("2021-11-01")),amount:5218.3},{date:new Date(Date.parse("2021-04-01")),amount:6079.73},{date:new Date(Date.parse("2021-09-01")),amount:5129},{date:new Date(Date.parse("2022-01-01")),amount:5271.17},{date:new Date(Date.parse("2021-05-01")),amount:6254.18},{date:new Date(Date.parse("2021-07-01")),amount:40280.91},{date:new Date(Date.parse("2021-12-01")),amount:5218.3},{date:new Date(Date.parse("2021-08-01")),amount:5129},{date:new Date(Date.parse("2021-10-01")),amount:5218.3}],id:"b1bb265c-1f43-4c55-be89-d45d5980f6c9",name:"Cash 2",type:"Cash",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-11-01")),amount:69239.74},{date:new Date(Date.parse("2021-10-01")),amount:84239.74},{date:new Date(Date.parse("2021-08-01")),amount:89239.74},{date:new Date(Date.parse("2021-07-01")),amount:87239.74},{date:new Date(Date.parse("2021-12-01")),amount:57266.74},{date:new Date(Date.parse("2021-06-01")),amount:72239.74},{date:new Date(Date.parse("2021-04-01")),amount:42240.63},{date:new Date(Date.parse("2021-05-01")),amount:82239.74},{date:new Date(Date.parse("2021-09-01")),amount:94239.74},{date:new Date(Date.parse("2022-01-01")),amount:52268.55}],id:"409d4daf-1e82-41e6-868f-10f7b07e4eea",name:"Cash 3",type:"Cash",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-09-01")),amount:317366},{date:new Date(Date.parse("2022-01-01")),amount:407768},{date:new Date(Date.parse("2021-04-01")),amount:208656},{date:new Date(Date.parse("2021-06-01")),amount:230487},{date:new Date(Date.parse("2021-11-01")),amount:393617},{date:new Date(Date.parse("2021-08-01")),amount:328161},{date:new Date(Date.parse("2021-10-01")),amount:346711},{date:new Date(Date.parse("2021-05-01")),amount:230433},{date:new Date(Date.parse("2021-12-01")),amount:427277},{date:new Date(Date.parse("2021-07-01")),amount:254852}],id:"35814c7b-c6c0-4d42-9999-c6a3bb5fabe5",name:"Invest 1",type:"Investment",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-12-01")),amount:82},{date:new Date(Date.parse("2021-05-01")),amount:240072},{date:new Date(Date.parse("2022-01-01")),amount:10071},{date:new Date(Date.parse("2021-07-01")),amount:200072},{date:new Date(Date.parse("2021-10-01")),amount:50072},{date:new Date(Date.parse("2021-08-01")),amount:90072},{date:new Date(Date.parse("2021-04-01")),amount:260072},{date:new Date(Date.parse("2021-11-01")),amount:30072},{date:new Date(Date.parse("2021-06-01")),amount:220072},{date:new Date(Date.parse("2021-09-01")),amount:70072}],id:"89cc16a3-1940-4fb3-bb78-759ede40006a",name:"Invest 2",type:"Investment",currency:"USD",sortKey:1},{entries:[{date:new Date(Date.parse("2021-11-01")),amount:6796.32},{date:new Date(Date.parse("2021-05-01")),amount:4902.71},{date:new Date(Date.parse("2021-08-01")),amount:4354.32},{date:new Date(Date.parse("2021-09-01")),amount:6578.02},{date:new Date(Date.parse("2021-12-01")),amount:7363.61},{date:new Date(Date.parse("2021-07-01")),amount:3959.97},{date:new Date(Date.parse("2021-10-01")),amount:5821.36},{date:new Date(Date.parse("2022-01-01")),amount:6041.41},{date:new Date(Date.parse("2021-04-01")),amount:82},{date:new Date(Date.parse("2021-06-01")),amount:4630.42}],id:"d05d7e7c-120c-4d15-8f79-14bcbf24c353",name:"Invest 3",type:"Investment",currency:"USD",sortKey:1}];async function N(){if(x.xh)return Promise.resolve(b);try{let e=await fetch(`${x.ft}/account`,{method:"get",credentials:"include"}),t=await e.json();return t.map(e=>({...e,entries:e.entries.map(e=>({...e,date:new Date(Date.parse(e.date))}))}))}catch(a){return console.warn("Failed to get user's accounts"),[]}}async function g(e){return await (0,x.v_)(`${x.ft}/account`,e).then(e=>e.json())}async function h(e){await (0,x.v_)(`${x.ft}/account/entry`,e)}async function v(e){return(0,x.gz)(`${x.ft}/account`,e)}var C=a(876),k=a(8873),O=a(6077),T=a(3667),S=a(4874),A=a(8674),I=a(7398),j=a(9828);function K(){return(K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let R={xAccessor:e=>e.x,yAccessor:e=>e.y},U=()=>{let e=(0,j.Z)(),{state:t}=(0,n.useContext)(p),{values:a}=(0,n.useContext)(c.Z),s=(0,n.useCallback)(e=>Object.keys(t.entries).map(n=>{let r=t.entries[n][e.name],c=void 0===r?void 0:(0,i.fK)(r,a.currencyRates.usd,e.currency,a.preferredDisplayCurrency);return{x:n,y:c}}),[a.currencyRates.usd,a.preferredDisplayCurrency,t.entries]),l=t.accounts.map(e=>({account:e,data:s(e)})),o=(0,n.useCallback)((e,a)=>{let n=l.filter(a).map(e=>e.data);return{name:e,data:Object.keys(t.entries).map((e,t)=>({x:e,y:n.map(e=>e[t].y??0).reduce((e,t)=>e+t,0)}))}},[l,t.entries]),u=["Cash","Investment"].map(e=>o(e,t=>t.account.type===e)).concat([o("Total",()=>!0)]),[m,d]=(0,n.useState)(!0);return n.createElement("div",{className:"py-4"},n.createElement("div",{className:"flex flex-row justify-end bg-transparent"},n.createElement("label",{className:"space-x-4 px-4"},n.createElement("span",{className:"h-full align-middle"},"Show totals"),n.createElement(r.ZD,{checked:m,onChange:e=>d(e.target.checked)}))),n.createElement(C.Z,{height:500,margin:{top:50,bottom:30,right:20,left:70},xScale:{type:"band"},yScale:{type:"linear"},theme:e?k.Z:O.Z},n.createElement(T.Z,{orientation:"bottom",hideAxisLine:!0}),n.createElement(T.Z,{orientation:"left"}),n.createElement(S.Z,{columns:!1,numTicks:4}),m?u.map(e=>n.createElement(A.Z,K({key:e.name,dataKey:e.name,data:e.data},R))):l.map(e=>n.createElement(A.Z,K({key:e.account.id,dataKey:e.account.name,data:e.data},R))),n.createElement(I.Z,{snapTooltipToDatumX:!0,snapTooltipToDatumY:!0,showVerticalCrosshair:!0,showSeriesGlyphs:!0,renderTooltip({tooltipData:e,colorScale:t}){if(e?.nearestDatum&&t)return n.createElement("div",{className:"flex flex-col"},n.createElement("div",{style:{color:t(e.nearestDatum.key)}},e.nearestDatum.key),n.createElement("span",null,R.xAccessor(e.nearestDatum.datum)),n.createElement("span",{className:"text-green-700 dark:text-green-500"},(0,i.xG)(R.yAccessor(e.nearestDatum.datum),a.preferredDisplayCurrency)))}})))};var Z=a(7145),_=a.n(Z),F=a(8493),z=a(6963),G=a(9272),P=a(9294);let L=({id:e,type:t,index:a,move:r,children:c,className:s})=>{let l=(0,n.useRef)(null),[{handlerId:o},u]=(0,G.L)({accept:t,collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){if(!l.current)return;let n=e.index;if(n===a)return;let c=l.current?.getBoundingClientRect(),s=(c.bottom-c.top)/2,o=t.getClientOffset(),u=o.y-c.top;n<a&&u<s||n>a&&u>s||(r(n,a),e.index=a)}},[a]),[{isDragging:m},i]=(0,P.c)(()=>({type:t,item:()=>({id:e,index:a}),collect:e=>({isDragging:!!e.isDragging()})}),[a]);return i(u(l)),n.createElement("li",{ref:l,"data-handler-id":o,className:`cursor-move ${m?"opacity-25":""} ${s||""}`},c)};var V=function({typeIdentifier:e,items:t,setItems:a,children:r,className:c}){let s=(0,n.useCallback)((e,t)=>{a(a=>_()(a,{$splice:[[e,1],[t,0,a[e]]]}))},[a]);return n.createElement(F.W,{backend:z.PD},n.createElement("ol",null,t.map((t,a)=>n.createElement(L,{key:t.id,id:t.id,index:a,move:s,type:e,className:c},r(t)))))};let $=()=>n.createElement("svg",{className:"h-5 w-5 animate-spin text-black dark:text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},n.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})),Y=({account:e})=>n.createElement("div",null,e.name),q=()=>{let{state:{accounts:e},dispatch:t}=(0,n.useContext)(p),[a,c]=(0,n.useState)(!1),[s,o]=(0,n.useState)("NONE"),[u,m]=(0,n.useState)((0,n.useMemo)(()=>e,[e])),i=(0,n.useCallback)(e=>n.createElement(Y,{account:e}),[]),d=(0,n.useCallback)(async()=>{try{o("SAVING");let e=u.map((e,t)=>({id:e.id,sortKey:t,name:e.name}));await v(e),t({type:"SORT ACCOUNTS",order:e}),o("SAVED"),setTimeout(()=>o("NONE"),1e3)}catch{console.warn("Unable to save order of accounts"),o("NONE")}},[t,u]);return n.createElement(n.Fragment,null,n.createElement(r.zx,{onClick:()=>c(!0),className:"btn btn-primary flex items-center gap-x-2"},n.createElement(l.j7b,{className:"inline"}),n.createElement("span",{className:"align-middle"},"Order accounts")),n.createElement(r.u_,{isOpen:a,onDismiss:()=>c(!1)},n.createElement("div",{className:"max-h-screen w-80 max-w-full overflow-y-scroll rounded bg-slate-200 p-4 dark:bg-slate-700"},n.createElement("h2",{className:"modal-header"},"Reorder accounts"),n.createElement(V,{className:"m-4 rounded bg-green-500 p-2",typeIdentifier:"ACCOUNT",items:u,setItems:m},i),n.createElement(r.qO,null,n.createElement(r.zx,{buttonType:"Secondary",onClick:()=>c(!1)},"Close"),n.createElement(r.zx,{onClick:d},"Save order"))),"NONE"!==s&&n.createElement("div",{className:"absolute top-0 left-0 z-10 flex h-full w-full flex-row items-center justify-center bg-black opacity-75"},"SAVING"===s&&n.createElement($,null),"SAVED"===s&&n.createElement("div",{className:"text-xl font-bold"},"Order saved!"))))};var M=a(1635);let B=({account:e,entry:t,date:a})=>{let{dispatch:r}=(0,n.useContext)(p),c=(0,n.useRef)(null),s=(0,n.useCallback)(async t=>{let n=(0,i.p3)(t.currentTarget.innerText);await h({date:a,amount:n,accountId:e.id}),r({type:"EDIT ENTRY FOR ACCOUNT",name:e.name,key:a,value:n})},[e.id,e.name,a,r]),l=(0,i.xG)(t[e.name],e.currency);return n.createElement("td",{key:e.name,contentEditable:!0,ref:c,onBlur:s,className:"px-4 text-right"},l)},W=()=>{let{state:{accounts:e,entries:t}}=(0,n.useContext)(p),a=Object.keys(t).map(a=>Q(e,t,a));return n.createElement("div",{className:"h-full overflow-x-auto pb-4"},n.createElement("table",{className:"w-full"},n.createElement(X,{accounts:e}),n.createElement("tbody",null,Object.keys(t).map((r,c)=>n.createElement("tr",{key:r,className:"whitespace-nowrap text-right font-mono odd:bg-gray-300 dark:odd:bg-gray-800"},n.createElement("td",{className:"pr-6 text-center"},r),n.createElement(H,{date:r,index:c,totals:a}),e.map(e=>n.createElement(B,{key:e.name,account:e,entry:t[r],date:r})),n.createElement(J,{date:r}))))))},X=({accounts:e})=>n.createElement("thead",null,n.createElement("tr",{className:"whitespace-nowrap text-right"},n.createElement("th",{className:"pr-6 text-center"},"Date"),n.createElement("th",{className:"px-4 text-green-700 dark:text-green-500"},"Gain"),n.createElement("th",{className:"px-4 text-blue-700 dark:text-blue-500"},"Total"),n.createElement("th",{className:"px-4 text-yellow-700 dark:text-yellow-500"},"Total cash"),n.createElement("th",{className:"px-4 text-purple-700 dark:text-purple-500"},"Total investments"),e.map(e=>n.createElement("th",{key:e.name,className:"px-4"},n.createElement("span",null,e.name))),n.createElement("th",null))),H=({index:e,date:t,totals:a})=>{let{state:{accounts:r,entries:s}}=(0,n.useContext)(p),{values:{preferredDisplayCurrency:l}}=(0,n.useContext)(c.Z),o=0===e?0:a[e]-a[e-1],u=a[e],m=Q(r,s,t,e=>"Cash"===e.type),d=Q(r,s,t,e=>"Investment"===e.type);return n.createElement(n.Fragment,null,n.createElement("td",{className:(0,M.y)(o)},(0,i.xG)(o,l)),n.createElement("td",{className:"px-4 text-blue-700 dark:text-blue-500"},(0,i.xG)(u,l)),n.createElement("td",{className:"px-4 text-yellow-700 dark:text-yellow-500"},(0,i.xG)(m,l)),n.createElement("td",{className:"px-4 text-purple-700 dark:text-purple-500"},(0,i.xG)(d,l)))},J=({date:e})=>{let{dispatch:t}=(0,n.useContext)(p);return n.createElement("td",{className:"pl-4"},n.createElement("button",{onClick:()=>t({type:"DELETE ENTRY",date:e}),className:"flex focus:outline-none"},n.createElement(l.BFV,{size:24,className:"text-red-700 dark:text-red-500"})))};function Q(e,t,a,r=()=>!0){let{values:{currencyRates:s,preferredDisplayCurrency:l}}=(0,n.useContext)(c.Z);return e.filter(r).map(e=>(0,i.fK)(t[a][e.name]??0,s.usd,e.currency,l)).reduce((e,t)=>e+t,0)}let ee=(0,n.memo)(()=>{let[e,t]=(0,n.useReducer)(y,(0,d.v)("account_state",D()));(0,n.useEffect)(()=>{N().then(e=>{let a={};for(let n of e)for(let r of n.entries){let c=(0,m.p)(r.date);c in a||(a[c]={}),a[c][n.name]=r.amount}t({type:"LOAD STATE",state:{accounts:e,entries:Object.keys(a).sort().reduce((e,t)=>(e[t]=a[t],e),{})}})})},[]);let a=(0,n.useCallback)(async e=>{await g(e),t({type:"ADD ACCOUNT",account:e})},[t]);return n.createElement(p.Provider,{value:{state:e,dispatch:t}},n.createElement(W,null),n.createElement("div",{className:"flex flex-row justify-between px-4"},n.createElement(u,{addAccount:a}),n.createElement(q,null),n.createElement(w,null)),n.createElement(U,null))});ee.displayName="AccountOverview";var et=a(447);let ea=()=>n.createElement(n.Fragment,null,n.createElement(et.Z,{title:"Accounts"}),n.createElement(ee,null));var en=ea},447:function(e,t,a){"use strict";var n=a(9008),r=a.n(n),c=a(7294);let s=({title:e})=>{let t=`${e} | Finance`;return c.createElement(r(),null,c.createElement("title",null,t))};t.Z=s},1635:function(e,t,a){"use strict";function n(e){return e>0?r.positiveColor:e<0?r.negativeColor:""}a.d(t,{y:function(){return n}});let r={positiveColor:"text-green-700 dark:text-green-500",negativeColor:"text-red-700 dark:text-red-500"}},515:function(e,t,a){"use strict";a.d(t,{CV:function(){return u},fK:function(){return s},p3:function(){return r},sL:function(){return o},xG:function(){return c}});var n=a(7294);function r(e){return Number.parseFloat(e.toString().replace(/[,a-zA-Z]/g,""))}function c(e,t){if(!e||Number.isNaN(e))return"0";let a=t=>e.toLocaleString("en-US",{style:"currency",currency:t,currencyDisplay:"symbol"});try{return a(t??"USD")}catch(n){if(n instanceof RangeError&&n.message.startsWith("Invalid currency code")&&t)return a("USD").replace("USD",t);return e.toString()}}function s(e,t,a,n){return e*l(t,a,n)}function l(e,t,a){return(t=t?.toLowerCase(),a=a?.toLowerCase(),t&&a&&t!==a)?"usd"===t?a in e?e[a]:1:"usd"===a?t in e?1/e[t]:1:l(e,t,"usd")*l(e,"usd",a):1}function o(e,t,a){return(0,n.useCallback)(n=>n*l(a,e,t),[e,a,t])}function u(e){return Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{})}Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"})},6645:function(e,t,a){"use strict";function n(e){let t=e.getFullYear(),a=""+(e.getMonth()+1),n=""+e.getDate();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[t,a,n].join("-")}a.d(t,{p:function(){return n}})},8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9532)}])}},function(e){e.O(0,[774,536,427,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);