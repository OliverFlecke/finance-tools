(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{318:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var a=n(7294),r=n(7818),c=n(2283),l=n(2370);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var o=({addAccount:e})=>{const[t,n]=(0,a.useState)(!1),{register:o,handleSubmit:u,formState:{errors:i}}=(0,c.cI)(),m=(0,a.useCallback)((()=>n(!1)),[n]);return a.createElement(a.Fragment,null,a.createElement("button",{onClick:()=>n((e=>!e)),className:"btn btn-primary space-x-2"},a.createElement(l.RWZ,{className:"inline"}),a.createElement("span",{className:"align-middle"},"Add account")),a.createElement(r.u_,{isOpen:t,onDismiss:m},a.createElement("form",{onSubmit:u((t=>{e(t),m()}))},a.createElement("div",{className:"p-4"},a.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-400"},"Add new account"),a.createElement("fieldset",{className:"space-y-2"},a.createElement(r.II,s({placeholder:"Savings, Investments...",label:"Name"},o("name",{required:!0}),{errorMessage:i.name&&"Please provide a name for your account"})),a.createElement("label",{className:"flex flex-col space-y-2"},a.createElement("span",{className:"text-gray-700 dark:text-gray-300 font-medium text-sm"},"Type"),a.createElement("select",s({className:"py-2 px-4 rounded-md shadow focus:outline-none focus:ring focus:border-indigo-400 bg-white dark:bg-gray-900 dark:text-gray-100 undefined"},o("type",{required:!0})),a.createElement("option",{value:"Cash"},"Cash"),a.createElement("option",{value:"Investment"},"Investment"))))),a.createElement(r.qO,null,a.createElement(r.zx,{buttonType:"Transparent",onClick:m},"Cancel"),a.createElement(r.zx,{type:"submit"},"Add")))))},u=n(9184),i=n(8381),m=n(5637);const d=(0,a.createContext)({state:{accounts:[],entries:{}},dispatch:e=>{}});function p(e,t){return(0,m.n)("account_state",E)(e,t)}function E(e,t){switch(t.type){case"RESET":return{accounts:[],entries:{}};case"LOAD STATE":return t.state;case"ADD ACCOUNT":return{...e,accounts:e.accounts.concat(t.account)};case"ADD ENTRY":return e.entries[t.date]={},{...e};case"EDIT ENTRY FOR ACCOUNT":return e.entries[t.key][t.name]=t.value,e.entries=(0,i.CV)(e.entries),{...e};case"DELETE ENTRY":return delete e.entries[t.date],{...e,entries:e.entries};default:return console.warn(`action type not handled: ${JSON.stringify(t)}`),e}}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}const y=(0,a.memo)((()=>{const{dispatch:e}=(0,a.useContext)(d),[t,n]=(0,a.useState)(!1),l=(0,a.useCallback)((()=>n(!1)),[n]),{register:s,handleSubmit:o}=(0,c.cI)(),u=o((({date:t})=>{e({type:"ADD ENTRY",date:t}),l()}));return a.createElement(a.Fragment,null,a.createElement(r.zx,{buttonType:"Primary",onClick:()=>n(!0)},"Add entry"),a.createElement(r.u_,{isOpen:t,onDismiss:l},a.createElement("form",{onSubmit:u},a.createElement("div",{className:"p-4"},a.createElement("h2",{className:"text-lg text-gray-700 dark:text-gray-400"},"Add new entry on date"),a.createElement(r.II,f({type:"date",className:"m-4"},s("date")))),a.createElement(r.qO,null,a.createElement(r.zx,{buttonType:"Primary",type:"submit"},"Add")))))}));y.displayName="AddEntryModal";var g=y,x=n(5563);var N=n(3162);var h=()=>{const{dispatch:e,state:t}=(0,a.useContext)(d),n=(0,a.useCallback)((()=>e({type:"RESET"})),[e]),r=(0,a.useCallback)((()=>{const e=new Blob([JSON.stringify(t)],{type:"text/plain;charset=utf-8"}),n=`finance_${(new Date).toISOString().slice(0,19)}.json`;(0,N.saveAs)(e,n)}),[t]),c=(0,a.useCallback)((async t=>{const n=t.target.files;if(!n||0===n.length)return;const a=n[0],r=await a.text();try{const t=JSON.parse(r);e({type:"LOAD STATE",state:t})}catch{console.warn(`Unable to parse file ${a.name}`)}}),[e]);return a.createElement("div",{className:"flex justify-end space-x-4"},a.createElement("button",{className:"btn btn-primary space-x-2",onClick:r},a.createElement(l.Tri,{className:"inline"}),a.createElement("span",{className:"align-middle"},"Save")),a.createElement("input",{type:"file",onChange:c,className:"bg-blue-400 p-2 rounded"}),a.createElement("button",{className:"btn btn-secondary",onClick:n},"Close"))},v=n(1788),b=n(9223),k=n(8143),w=n(9599),C=n(97),T=n(4993),O=n(3499),S=n(2923),A=n(7481),D=n(3650),Z=n(1232),_=n(6737),I=n(3865),j=n(8823),R=n(424),F=n(9808),L=n.n(F);var $=()=>{const{state:e}=(0,a.useContext)(d),t=Object.keys(e.entries).map((t=>({date:t,value:e.entries[t]}))),n=[L().amber,L().blueGray,L().green,L().pink,L().yellow,L().rose,L().purple,L().sky,L().indigo];return a.createElement(S.Z,null,(r=>{const c=24,l=24,s=24,o=24,u=r.width,i=u-s-o,m=300-c-l-20,d=(0,A.Z)({range:[0,i],domain:(0,I.Z)(t,(e=>new Date(e.date)))}),p=(0,j.Z)(t.map((t=>(0,j.Z)(e.accounts.map((e=>t.value[e.name])))??0))??0),E=(0,D.Z)({range:[m,0],domain:[0,p??0],nice:!0}),f=(0,R.Z)(0,p??0,10,"~s"),y=L().cyan[500],g=(0,Z.Z)({domain:e.accounts.map((e=>e.name)),range:e.accounts.map(((e,t)=>n[t][500]))});return a.createElement("div",null,a.createElement("svg",{width:u,height:300},a.createElement(w.Z,{top:25,left:65},a.createElement(v.Z,{scale:E,numTicks:10,strokeWidth:1,tickFormat:f,stroke:y,tickLabelProps:()=>({fill:y,textAnchor:"end",verticalAnchor:"middle"})}),a.createElement(b.Z,{top:m,left:0,numTicks:4,scale:d,stroke:"transparent",tickLabelProps:()=>({fill:y,textAnchor:"middle",verticalAnchor:"middle"})}),e.accounts.map(((e,r)=>a.createElement(P,{key:e.name,account:e,color:n[r][500],data:t,xScale:d,yScale:E}))))),a.createElement(C.Z,{scale:g,labelFormat:e=>`${e.toUpperCase()}`},(e=>a.createElement("div",{className:"flex flex-row flex-wrap"},e.map(((e,t)=>a.createElement(T.Z,{key:`legend-quantile-${t}`,margin:"0 5px"},a.createElement("svg",{width:15,height:15},a.createElement("rect",{fill:e.value,width:15,height:15})),a.createElement(O.Z,{align:"left",margin:"0 0 0 4px"},e.text))))))))}))};const P=({account:e,color:t,data:n,yScale:r,xScale:c})=>{const l=(e,t)=>n=>e(t(n)),s=l(c,(e=>new Date(e.date))),o=l(r,(t=>t.value[e.name]));return a.createElement(_.Z,{data:n,x:e=>s(e)??0,y:e=>o(e)??0,strokeWidth:1.5,stroke:t,curve:k.Z})};var B=({account:e,entry:t,date:n})=>{const{dispatch:r}=(0,a.useContext)(d),c=(0,a.useRef)(null),l=(0,a.useCallback)((async t=>{const a=(0,i.p3)(t.currentTarget.innerText);NaN!==a&&(await async function(e){await(0,x.v_)(`${x.NS}/${x.tW}/account/entry`,e)}({date:n,amount:a,accountId:e.id}),r({type:"EDIT ENTRY FOR ACCOUNT",name:e.name,key:n,value:a}))}),[e.id,e.name,n,r]),s=i.oB.format(t[e.name]??0);return a.createElement("td",{key:e.name,contentEditable:!0,ref:c,onBlur:l,className:"px-2 text-right"},s)};var U=({accounts:e,entries:t})=>{const{dispatch:n}=(0,a.useContext)(d),r=Object.keys(t).map((n=>Y(e,t,n)));return a.createElement("div",{className:"h-full overflow-x-auto pb-4"},a.createElement("table",{className:"w-full"},a.createElement("thead",null,a.createElement("tr",{className:"text-right whitespace-nowrap"},a.createElement("th",{className:"text-center"},"Date"),a.createElement("th",{className:"text-green-700 dark:text-green-500"},"Gain"),a.createElement("th",{className:"text-blue-700 dark:text-blue-500"},"Total"),a.createElement("th",{className:"text-yellow-700 dark:text-yellow-500"},"Total cash"),a.createElement("th",{className:"text-purple-700 dark:text-purple-500"},"Total investments"),e.map((e=>a.createElement("th",{key:e.name},a.createElement("span",null,e.name)))),a.createElement("th",null))),a.createElement("tbody",null,Object.keys(t).map(((c,s)=>{const o=0===s?0:r[s]-r[s-1],u=r[s],m=Y(e,t,c,(e=>"Cash"===e.type)),d=Y(e,t,c,(e=>"Investment"===e.type));return a.createElement("tr",{key:c,className:"odd:bg-gray-300 dark:odd:bg-coolGray-800 text-right whitespace-nowrap font-mono"},a.createElement("td",{className:"text-center"},c),a.createElement("td",{className:"text-green-700 dark:text-green-500"},i.oB.format(o)),a.createElement("td",{className:"text-blue-700 dark:text-blue-500"},i.oB.format(u)),a.createElement("td",{className:"text-yellow-700 dark:text-yellow-500"},i.oB.format(m)),a.createElement("td",{className:"text-purple-700 dark:text-purple-500"},i.oB.format(d)),e.map((e=>a.createElement(B,{key:e.name,account:e,entry:t[c],date:c}))),a.createElement("td",null,a.createElement("button",{onClick:()=>n({type:"DELETE ENTRY",date:c}),className:"flex  focus:outline-none"},a.createElement(l.BFV,{size:24,className:"text-red-700 dark:text-red-500"}))))})))))};function Y(e,t,n,a=(()=>!0)){return e.filter(a).map((e=>t[n][e.name]??0)).reduce(((e,t)=>e+t),0)}const z=(0,a.memo)((()=>{const[e,t]=(0,a.useReducer)(p,(0,m.v)("account_state",{accounts:[],entries:{}}));(0,a.useEffect)((()=>{(async function(){const e=await fetch(`${x.NS}/${x.tW}/account`,{method:"get",credentials:"include"});return(await e.json()).map((e=>({...e,entries:e.entries.map((e=>({...e,date:new Date(Date.parse(e.date))})))})))})().then((e=>{const n={};for(const t of e)for(const e of t.entries){const a=(0,u.p)(e.date);a in n||(n[a]={}),n[a][t.name]=e.amount}t({type:"LOAD STATE",state:{accounts:e,entries:Object.keys(n).sort().reduce(((e,t)=>(e[t]=n[t],e)),{})}})}))}),[]);const n=(0,a.useCallback)((async e=>{await async function(e){return await(0,x.v_)(`${x.NS}/${x.tW}/account`,e).then((e=>e.json()))}(e),t({type:"ADD ACCOUNT",account:e})}),[t]);return a.createElement(d.Provider,{value:{state:e,dispatch:t}},a.createElement(U,{accounts:e.accounts,entries:e.entries}),a.createElement("div",{className:"px-4 flex flex-row justify-between"},a.createElement(o,{addAccount:n}),a.createElement(g,null)),a.createElement("div",{className:"p-4"},a.createElement(h,null)),a.createElement($,null))}));z.displayName="AccountOverview";var W=z,q=n(7515);var J=()=>a.createElement(a.Fragment,null,a.createElement(q.Z,{title:"Accounts"}),a.createElement(W,null))},7515:function(e,t,n){"use strict";var a=n(9008),r=n(7294);t.Z=({title:e})=>r.createElement(a.default,null,r.createElement("title",null,e," | Finance"))},8381:function(e,t,n){"use strict";n.d(t,{p3:function(){return r},oB:function(){return c},xG:function(){return l},fK:function(){return s},sL:function(){return u},CV:function(){return m}});var a=n(7294);function r(e){return Number.parseFloat(e.toString().replace(/[,a-zA-Z]/g,""))}const c=Intl.NumberFormat(void 0,{style:"currency",currency:"DKK",currencyDisplay:"code"});function l(e,t){return Number.isNaN(e)?"-":e.toLocaleString(void 0,{style:"currency",currency:t??"USD",currencyDisplay:"code"})}function s(e,t,n,a){return e*o(t,n,a)}function o(e,t,n){var a,r;const c="usd";return e=null===(a=e)||void 0===a?void 0:a.toLowerCase(),t=null===(r=t)||void 0===r?void 0:r.toLowerCase(),n=n??i,e&&t&&e!==t?e===c?t in n?n[t]:1:t===c?e in n?1/n[e]:1:o(e,c)*o(c,t):1}function u(e,t,n){return(0,a.useCallback)((a=>s(a,e,t,n)),[e,n,t])}const i={dkk:6.36,nok:9,eur:.85};function m(e){return Object.keys(e).sort().reduce(((t,n)=>(t[n]=e[n],t)),{})}},9184:function(e,t,n){"use strict";function a(e){const t=e.getFullYear();let n=""+(e.getMonth()+1),a=""+e.getDate();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[t,n,a].join("-")}n.d(t,{p:function(){return a}})},5637:function(e,t,n){"use strict";function a(e,t={}){const n=localStorage.getItem(e)??void 0;return{...t,...void 0===n||""===n?{}:JSON.parse(n)}}function r(e,t){return(n,a)=>{const r=t(n,a);return localStorage.setItem(e,JSON.stringify(r)),r}}n.d(t,{v:function(){return a},n:function(){return r}})},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(318)}])}},function(e){e.O(0,[774,283,617,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);